<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resso Finances</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Custom gradients and effects */
        .gradient-bg {
            background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%);
        }
        .hover-scale {
            transition: transform 0.2s;
        }
        .hover-scale:hover {
            transform: scale(1.02);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        .transaction-card {
            transition: all 0.3s ease;
        }
        .transaction-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body class="h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col" style="font-family: system-ui, -apple-system, sans-serif;">
    <div x-data="finances()">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between fixed top-0 left-0 right-0 z-30">
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">R</span>
                    </div>
                    <span class="font-semibold text-gray-900">Resso</span>
                    <span class="text-gray-400">•</span>
                    <span class="text-gray-600">Финансы</span>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button @click="showTransactionModal = true; selectedTransaction = null; setTransactionForm()"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    <span>Новая транзакция</span>
                </button>
                <div class="flex bg-gray-100 rounded-lg p-1">
                    <button @click="view = 'overview'"
                            :class="{'bg-white shadow-sm text-blue-600': view === 'overview', 'text-gray-600 hover:text-gray-900': view !== 'overview'}"
                            class="px-3 py-1 rounded-md text-sm transition-colors">
                        <i data-lucide="pie-chart" class="w-4 h-4 inline-block mr-1"></i>
                        Обзор
                    </button>
                    <button @click="view = 'transactions'"
                            :class="{'bg-white shadow-sm text-blue-600': view === 'transactions', 'text-gray-600 hover:text-gray-900': view !== 'transactions'}"
                            class="px-3 py-1 rounded-md text-sm transition-colors">
                        <i data-lucide="list" class="w-4 h-4 inline-block mr-1"></i>
                        Транзакции
                    </button>
                    <button @click="view = 'reports'"
                            :class="{'bg-white shadow-sm text-blue-600': view === 'reports', 'text-gray-600 hover:text-gray-900': view !== 'reports'}"
                            class="px-3 py-1 rounded-md text-sm transition-colors">
                        <i data-lucide="bar-chart-2" class="w-4 h-4 inline-block mr-1"></i>
                        Отчеты
                    </button>
                    <button @click="view = 'accounting'"
                            :class="{'bg-white shadow-sm text-blue-600': view === 'accounting', 'text-gray-600 hover:text-gray-900': view !== 'accounting'}"
                            class="px-3 py-1 rounded-md text-sm transition-colors">
                        <i data-lucide="calculator" class="w-4 h-4 inline-block mr-1"></i>
                        Учет
                    </button>
                    <button @click="view = 'aiAdvice'"
                            :class="{'bg-white shadow-sm text-blue-600': view === 'aiAdvice', 'text-gray-600 hover:text-gray-900': view !== 'aiAdvice'}"
                            class="px-3 py-1 rounded-md text-sm transition-colors">
                        <i data-lucide="brain" class="w-4 h-4 inline-block mr-1"></i>
                        ИИ советы
                    </button>
                </div>
                <div class="relative">
                    <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                    <input type="text" 
                           placeholder="Поиск транзакций..."
                           class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-64"
                           x-model="searchQuery"
                           @input="searchTransactions">
                </div>
                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                    <i data-lucide="user" class="w-4 h-4 text-white"></i>
                </div>
            </div>
        </header>

        <div class="flex flex-1 overflow-hidden pt-16">
            <!-- Sidebar -->
            <aside class="w-64 bg-white border-r border-gray-200 p-4 space-y-6 fixed left-0 top-16 bottom-0 overflow-y-auto no-scrollbar">
                <!-- Navigation Menu -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-medium text-gray-900">Навигация</h3>
                        <button @click="isNavCollapsed = !isNavCollapsed" 
                                class="text-gray-500 hover:text-blue-600 transition-colors duration-200 p-1 rounded-lg hover:bg-blue-50">
                            <i data-lucide="chevron-down" 
                               class="w-5 h-5 transition-all duration-300 ease-in-out"
                               :class="{'rotate-180': isNavCollapsed}"></i>
                        </button>
                    </div>
                    <div class="space-y-1 overflow-hidden transition-all duration-300 ease-in-out"
                         :class="{'max-h-0 opacity-0': isNavCollapsed, 'max-h-[500px] opacity-100': !isNavCollapsed}">
                        <a href="index.html" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                            <i data-lucide="home" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Главная</span>
                        </a>
                        <a href="emploee.html" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                            <i data-lucide="users" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Сотрудники</span>
                        </a>
                        <a href="notifications.html" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                            <i data-lucide="bell" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Уведомления</span>
                        </a>
                        <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                            <i data-lucide="user-plus" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Клиенты</span>
                        </a>
                        <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                            <i data-lucide="calendar" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Записи</span>
                        </a>
                        <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                            <i data-lucide="scissors" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Услуги</span>
                        </a>
                        <a href="finances.html" class="flex items-center space-x-2 px-3 py-2 bg-blue-50 text-blue-600 rounded-lg">
                            <i data-lucide="dollar-sign" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Финансы</span>
                        </a>
                        <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                            <i data-lucide="bar-chart-2" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Отчеты</span>
                        </a>
                        <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                            <i data-lucide="settings" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Настройки</span>
                        </a>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-medium text-gray-900">Статистика</h3>
                        <button @click="isStatsCollapsed = !isStatsCollapsed" 
                                class="text-gray-500 hover:text-blue-600 transition-colors duration-200 p-1 rounded-lg hover:bg-blue-50">
                            <i data-lucide="chevron-down" 
                               class="w-5 h-5 transition-all duration-300 ease-in-out"
                               :class="{'rotate-180': isStatsCollapsed}"></i>
                        </button>
                    </div>
                    <div class="space-y-4 overflow-hidden transition-all duration-300 ease-in-out"
                         :class="{'max-h-0 opacity-0': isStatsCollapsed, 'max-h-[500px] opacity-100': !isStatsCollapsed}">
                        <div class="stat-card p-4 rounded-lg border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm text-gray-600">Доход за месяц</div>
                                    <div class="text-xl font-semibold text-gray-900" x-text="formatCurrency(getMonthlyIncome())"></div>
                                </div>
                                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center">
                                    <i data-lucide="trending-up" class="w-4 h-4 text-green-600"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card p-4 rounded-lg border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm text-gray-600">Расходы за месяц</div>
                                    <div class="text-xl font-semibold text-gray-900" x-text="formatCurrency(getMonthlyExpenses())"></div>
                                </div>
                                <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center">
                                    <i data-lucide="trending-down" class="w-4 h-4 text-red-600"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card p-4 rounded-lg border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm text-gray-600">Прибыль за месяц</div>
                                    <div class="text-xl font-semibold text-gray-900" x-text="formatCurrency(getMonthlyProfit())"></div>
                                </div>
                                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                    <i data-lucide="dollar-sign" class="w-4 h-4 text-blue-600"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-medium text-gray-900">Фильтры</h3>
                        <button @click="isFiltersCollapsed = !isFiltersCollapsed" 
                                class="text-gray-500 hover:text-blue-600 transition-colors duration-200 p-1 rounded-lg hover:bg-blue-50">
                            <i data-lucide="chevron-down" 
                               class="w-5 h-5 transition-all duration-300 ease-in-out"
                               :class="{'rotate-180': isFiltersCollapsed}"></i>
                        </button>
                    </div>
                    <div class="space-y-4 overflow-hidden transition-all duration-300 ease-in-out"
                         :class="{'max-h-0 opacity-0': isFiltersCollapsed, 'max-h-[500px] opacity-100': !isFiltersCollapsed}">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Тип</label>
                            <select x-model="selectedType"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="all">Все типы</option>
                                <option value="income">Доход</option>
                                <option value="expense">Расход</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Категория</label>
                            <select x-model="selectedCategory"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="all">Все категории</option>
                                <option value="services">Услуги</option>
                                <option value="products">Товары</option>
                                <option value="salary">Зарплата</option>
                                <option value="rent">Аренда</option>
                                <option value="utilities">Коммунальные услуги</option>
                                <option value="other">Прочее</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Период</label>
                            <select x-model="selectedPeriod"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="today">Сегодня</option>
                                <option value="week">Неделя</option>
                                <option value="month">Месяц</option>
                                <option value="year">Год</option>
                                <option value="custom">Произвольный</option>
                            </select>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 overflow-auto ml-64 p-6">
                <!-- Overview View -->
                <div x-show="view === 'overview'" class="space-y-6">
                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Income vs Expenses Chart -->
                        <div class="bg-white rounded-xl shadow-sm p-6 h-[500px] hover:shadow-md transition-shadow duration-300">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Доходы и расходы</h3>
                                <div class="flex items-center space-x-2">
                                    <span class="flex items-center text-sm text-green-600">
                                        <i data-lucide="circle" class="w-3 h-3 mr-1"></i>
                                        Доходы
                                    </span>
                                    <span class="flex items-center text-sm text-red-600">
                                        <i data-lucide="circle" class="w-3 h-3 mr-1"></i>
                                        Расходы
                                    </span>
                                </div>
                            </div>
                            <div class="relative h-[400px]" style="height: 90%;">
                                <canvas id="incomeExpensesChart"></canvas>
                            </div>
                        </div>
                        <!-- Categories Chart -->
                        <div class="bg-white rounded-xl shadow-sm p-6 h-[500px] hover:shadow-md transition-shadow duration-300">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">По категориям</h3>
                                <div class="text-sm text-gray-500">Распределение расходов</div>
                            </div>
                            <div class="relative h-[400px]">
                                <canvas id="categoriesChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Transactions -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Последние транзакции</h3>
                        </div>
                        <div class="divide-y divide-gray-200">
                            <template x-for="transaction in recentTransactions" :key="transaction.id">
                                <div class="transaction-card p-6 hover:bg-gray-50 cursor-pointer" @click="viewTransactionDetails(transaction)">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div :class="getTransactionIconClass(transaction.type)"
                                                 class="w-10 h-10 rounded-lg flex items-center justify-center">
                                                <i :data-lucide="getTransactionIcon(transaction.type)" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <div class="text-sm font-medium text-gray-900" x-text="transaction.category"></div>
                                                <div class="text-sm text-gray-500" x-text="transaction.description || ''"></div>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div :class="getAmountClass(transaction.type)"
                                                 class="text-sm font-medium"
                                                 x-text="formatCurrency(transaction.amount)"></div>
                                            <div class="text-sm text-gray-500" x-text="formatDate(transaction.date)"></div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Transactions View -->
                <div x-show="view === 'transactions'" class="space-y-6">
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Все транзакции</h3>
                        </div>
                        <div class="divide-y divide-gray-200">
                            <template x-for="transaction in filteredTransactions" :key="transaction.id">
                                <div class="transaction-card p-6 hover:bg-gray-50 cursor-pointer" @click="viewTransactionDetails(transaction)">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div :class="getTransactionIconClass(transaction.type)"
                                                 class="w-10 h-10 rounded-lg flex items-center justify-center">
                                                <i :data-lucide="getTransactionIcon(transaction.type)" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <div class="text-sm font-medium text-gray-900" x-text="transaction.category"></div>
                                                <div class="text-sm text-gray-500" x-text="transaction.description || ''"></div>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div :class="getAmountClass(transaction.type)"
                                                 class="text-sm font-medium"
                                                 x-text="formatCurrency(transaction.amount)"></div>
                                            <div class="text-sm text-gray-500" x-text="formatDate(transaction.date)"></div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Reports View -->
                <div x-show="view === 'reports'" class="space-y-6">
                    <!-- Report Controls -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">Финансовые отчеты</h3>
                            <div class="flex items-center space-x-4">
                                <select x-model="selectedReportPeriod" 
                                        class="border border-gray-200 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="week">За неделю</option>
                                    <option value="month">За месяц</option>
                                    <option value="quarter">За квартал</option>
                                    <option value="year">За год</option>
                                    <option value="custom">Произвольный период</option>
                                </select>
                                <button @click="exportReport" 
                                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    <span>Экспорт отчета</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-sm font-medium text-gray-900">Общий доход</h4>
                                <span class="text-green-600">
                                    <i data-lucide="trending-up" class="w-4 h-4"></i>
                                </span>
                            </div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="formatCurrency(getReportIncome())"></div>
                            <div class="mt-2 text-sm text-gray-500" x-text="getIncomeChange() + '%'"></div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-sm font-medium text-gray-900">Общие расходы</h4>
                                <span class="text-red-600">
                                    <i data-lucide="trending-down" class="w-4 h-4"></i>
                                </span>
                            </div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="formatCurrency(getReportExpenses())"></div>
                            <div class="mt-2 text-sm text-gray-500" x-text="getExpensesChange() + '%'"></div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-sm font-medium text-gray-900">Чистая прибыль</h4>
                                <span class="text-blue-600">
                                    <i data-lucide="dollar-sign" class="w-4 h-4"></i>
                                </span>
                            </div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="formatCurrency(getReportProfit())"></div>
                            <div class="mt-2 text-sm text-gray-500" x-text="getProfitChange() + '%'"></div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Monthly Report -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Динамика прибыли</h3>
                                <div class="text-sm text-gray-500">По месяцам</div>
                            </div>
                            <div class="relative h-[300px]">
                                <canvas id="monthlyReportChart"></canvas>
                            </div>
                        </div>
                        <!-- Category Report -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Распределение доходов</h3>
                                <div class="text-sm text-gray-500">По категориям</div>
                            </div>
                            <div class="relative h-[300px]">
                                <canvas id="categoryReportChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Reports -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Top Income Sources -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Основные источники дохода</h3>
                                <div class="text-sm text-gray-500">Топ 5</div>
                            </div>
                            <div class="space-y-4">
                                <template x-for="(source, index) in getTopIncomeSources()" :key="index">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center">
                                                <i data-lucide="trending-up" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                            <div>
                                                <div class="text-sm font-medium text-gray-900" x-text="source.category"></div>
                                                <div class="text-xs text-gray-500" x-text="source.count + ' транзакций'"></div>
                                            </div>
                                        </div>
                                        <div class="text-sm font-medium text-green-600" x-text="formatCurrency(source.amount)"></div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Top Expenses -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Крупнейшие расходы</h3>
                                <div class="text-sm text-gray-500">Топ 5</div>
                            </div>
                            <div class="space-y-4">
                                <template x-for="(expense, index) in getTopExpenses()" :key="index">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center">
                                                <i data-lucide="trending-down" class="w-4 h-4 text-red-600"></i>
                                            </div>
                                            <div>
                                                <div class="text-sm font-medium text-gray-900" x-text="expense.category"></div>
                                                <div class="text-xs text-gray-500" x-text="formatDate(expense.date)"></div>
                                            </div>
                                        </div>
                                        <div class="text-sm font-medium text-red-600" x-text="formatCurrency(expense.amount)"></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="text-sm font-medium text-gray-900 mb-2">Рентабельность</div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="getProfitability() + '%'"></div>
                            <div class="mt-2 text-sm text-gray-500">Отношение прибыли к доходам</div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="text-sm font-medium text-gray-900 mb-2">Средний чек</div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="formatCurrency(getAverageCheck())"></div>
                            <div class="mt-2 text-sm text-gray-500">Средняя сумма транзакции</div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="text-sm font-medium text-gray-900 mb-2">Количество транзакций</div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="getTransactionCount()"></div>
                            <div class="mt-2 text-sm text-gray-500">За выбранный период</div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="text-sm font-medium text-gray-900 mb-2">Темп роста</div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="getGrowthRate() + '%'"></div>
                            <div class="mt-2 text-sm text-gray-500">По сравнению с прошлым периодом</div>
                        </div>
                    </div>
                </div>

                <!-- Accounting View -->
                <div x-show="view === 'accounting'" class="space-y-6">
                    <!-- Accounting Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Баланс</h3>
                            <div class="text-3xl font-bold text-gray-900" x-text="formatCurrency(getTotalBalance())"></div>
                            <div class="mt-2 text-sm text-gray-500">Общий баланс на текущий момент</div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Доходы</h3>
                            <div class="text-3xl font-bold text-green-600" x-text="formatCurrency(getTotalIncome())"></div>
                            <div class="mt-2 text-sm text-gray-500">Общая сумма доходов</div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Расходы</h3>
                            <div class="text-3xl font-bold text-red-600" x-text="formatCurrency(getTotalExpenses())"></div>
                            <div class="mt-2 text-sm text-gray-500">Общая сумма расходов</div>
                        </div>
                    </div>

                    <!-- Financial Records -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Финансовые записи</h3>
                            <button @click="showTransactionModal = true; selectedTransaction = null; setTransactionForm()"
                                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>Добавить запись</span>
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Описание</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Категория</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Тип</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Сумма</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="transaction in transactions" :key="transaction.id">
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatDate(transaction.date)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="transaction.category"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="transaction.description || ''"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span :class="transaction.type === 'income' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                                                      class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                                      x-text="transaction.type === 'income' ? 'Доход' : 'Расход'">
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm"
                                                :class="transaction.type === 'income' ? 'text-green-600' : 'text-red-600'"
                                                x-text="formatCurrency(transaction.amount)">
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <button @click="editTransaction(transaction)"
                                                        class="text-blue-600 hover:text-blue-900 mr-3">
                                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                                </button>
                                                <button @click="deleteTransaction(transaction.id)"
                                                        class="text-red-600 hover:text-red-900">
                                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- AI Advice View -->
                <div x-show="view === 'aiAdvice'" class="space-y-6">
                    <!-- AI Insights Header -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">ИИ Финансовые советы</h3>
                                <p class="text-sm text-gray-500 mt-1">Персонализированные рекомендации на основе ваших финансовых данных</p>
                            </div>
                            <button @click="refreshAIAdvice" 
                                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                <span>Обновить советы</span>
                            </button>
                        </div>
                    </div>

                    <!-- AI Insights Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Spending Analysis -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center">
                                    <i data-lucide="trending-up" class="w-5 h-5 text-purple-600"></i>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-900">Анализ расходов</h4>
                            </div>
                            <div class="space-y-4">
                                <template x-for="(insight, index) in aiInsights.spending" :key="index">
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <div class="flex items-start space-x-3">
                                            <div class="flex-shrink-0">
                                                <i :data-lucide="insight.icon" class="w-5 h-5 text-blue-600"></i>
                                            </div>
                                            <div>
                                                <p class="text-sm text-gray-900" x-text="insight.message"></p>
                                                <p class="text-xs text-gray-500 mt-1" x-text="insight.details"></p>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Income Optimization -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center">
                                    <i data-lucide="dollar-sign" class="w-5 h-5 text-green-600"></i>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-900">Оптимизация доходов</h4>
                            </div>
                            <div class="space-y-4">
                                <template x-for="(insight, index) in aiInsights.income" :key="index">
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <div class="flex items-start space-x-3">
                                            <div class="flex-shrink-0">
                                                <i :data-lucide="insight.icon" class="w-5 h-5 text-green-600"></i>
                                            </div>
                                            <div>
                                                <p class="text-sm text-gray-900" x-text="insight.message"></p>
                                                <p class="text-xs text-gray-500 mt-1" x-text="insight.details"></p>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Financial Health -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
                                    <i data-lucide="heart" class="w-5 h-5 text-blue-600"></i>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-900">Финансовое здоровье</h4>
                            </div>
                            <div class="space-y-4">
                                <template x-for="(insight, index) in aiInsights.health" :key="index">
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <div class="flex items-start space-x-3">
                                            <div class="flex-shrink-0">
                                                <i :data-lucide="insight.icon" class="w-5 h-5 text-blue-600"></i>
                                            </div>
                                            <div>
                                                <p class="text-sm text-gray-900" x-text="insight.message"></p>
                                                <p class="text-xs text-gray-500 mt-1" x-text="insight.details"></p>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Growth Opportunities -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-10 h-10 rounded-lg bg-yellow-100 flex items-center justify-center">
                                    <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-600"></i>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-900">Возможности роста</h4>
                            </div>
                            <div class="space-y-4">
                                <template x-for="(insight, index) in aiInsights.growth" :key="index">
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <div class="flex items-start space-x-3">
                                            <div class="flex-shrink-0">
                                                <i :data-lucide="insight.icon" class="w-5 h-5 text-yellow-600"></i>
                                            </div>
                                            <div>
                                                <p class="text-sm text-gray-900" x-text="insight.message"></p>
                                                <p class="text-xs text-gray-500 mt-1" x-text="insight.details"></p>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Transaction Modal -->
        <div x-show="showTransactionModal" class="fixed inset-0 z-50">
            <div class="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm"></div>
            <div class="fixed inset-0 flex items-center justify-center">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-6xl mx-4" style="margin-top: 10vh; margin-bottom: 10vh;">
                    <div class="p-8">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-900" x-text="selectedTransaction ? 'Редактировать транзакцию' : 'Новая транзакция'"></h3>
                            <button @click="showTransactionModal = false" class="text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-lg">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-6">
                            <!-- Основная информация -->
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Сумма -->
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Сумма</label>
                                    <div class="relative">
                                        <span class="absolute left-4 -translate-y-1/2 text-gray-500 text-sm leading-none" style="top: 40%">⃀</span>
                                        <input type="number" 
                                               class="w-full pl-8 pr-4 py-3 border border-gray-200 rounded-xl text-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50"
                                               x-model="transactionForm.amount"
                                               placeholder="0">
                                    </div>
                                </div>

                                <!-- Тип транзакции -->
                            <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Тип</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <button @click="transactionForm.type = 'income'"
                                                :class="{'bg-green-50 border-green-500 text-green-700 shadow-sm': transactionForm.type === 'income', 'border-gray-200 text-gray-700 hover:bg-gray-50': transactionForm.type !== 'income'}"
                                                class="flex items-center justify-center space-x-2 px-4 py-3 border rounded-xl transition-all">
                                            <i data-lucide="trending-up" class="w-5 h-5"></i>
                                            <span>Доход</span>
                                        </button>
                                        <button @click="transactionForm.type = 'expense'"
                                                :class="{'bg-red-50 border-red-500 text-red-700 shadow-sm': transactionForm.type === 'expense', 'border-gray-200 text-gray-700 hover:bg-gray-50': transactionForm.type !== 'expense'}"
                                                class="flex items-center justify-center space-x-2 px-4 py-3 border rounded-xl transition-all">
                                            <i data-lucide="trending-down" class="w-5 h-5"></i>
                                            <span>Расход</span>
                                        </button>
                            </div>
                                </div>

                                <!-- Категория -->
                            <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Категория</label>
                                <select x-model="transactionForm.category"
                                            class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50">
                                    <option value="services">Услуги</option>
                                    <option value="products">Товары</option>
                                    <option value="salary">Зарплата</option>
                                    <option value="rent">Аренда</option>
                                    <option value="utilities">Коммунальные услуги</option>
                                    <option value="other">Прочее</option>
                                </select>
                            </div>
                            </div>

                            <!-- Дополнительная информация -->
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Описание -->
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Описание
                                        <span class="text-gray-400 text-xs font-normal">(необязательно)</span>
                                    </label>
                                    <textarea x-model="transactionForm.description"
                                              class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50"
                                              rows="2"
                                              placeholder="Введите описание транзакции"></textarea>
                                </div>

                                <!-- Клиент/Поставщик -->
                            <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <span x-text="transactionForm.type === 'income' ? 'Клиент' : 'Поставщик'"></span>
                                        <span class="text-gray-400 text-xs font-normal">(необязательно)</span>
                                    </label>
                                <input type="text" 
                                           class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50"
                                           x-model="transactionForm.client"
                                           :placeholder="transactionForm.type === 'income' ? 'Введите имя клиента' : 'Введите название поставщика'">
                            </div>

                                <!-- Способ оплаты -->
                            <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Способ оплаты</label>
                                    <select x-model="transactionForm.paymentMethod"
                                            class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50">
                                        <option value="cash">Наличные</option>
                                        <option value="card">Карта</option>
                                        <option value="bank">Банковский перевод</option>
                                        <option value="other">Другое</option>
                                    </select>
                            </div>
                        </div>

                            <!-- Метки и повторения -->
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Метки -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Метки</label>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="tag in ['Важное', 'Регулярное', 'Срочное']" :key="tag">
                                            <button @click="toggleTag(tag)"
                                                    :class="{'bg-blue-50 text-blue-700 border-blue-200 shadow-sm': transactionForm.tags?.includes(tag), 'bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100': !transactionForm.tags?.includes(tag)}"
                                                    class="px-3 py-2 border rounded-full text-sm transition-all">
                                                <span x-text="tag"></span>
                                            </button>
                                        </template>
                                    </div>
                                </div>

                                <!-- Повторение -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Повторение</label>
                                    <select x-model="transactionForm.recurring"
                                            class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50">
                                        <option value="none">Без повторения</option>
                                        <option value="daily">Ежедневно</option>
                                        <option value="weekly">Еженедельно</option>
                                        <option value="monthly">Ежемесячно</option>
                                        <option value="yearly">Ежегодно</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 flex justify-end space-x-4">
                            <button @click="showTransactionModal = false"
                                    class="px-5 py-2.5 text-gray-600 hover:bg-gray-100 rounded-xl transition-colors">
                                Отмена
                            </button>
                            <button @click="saveTransaction"
                                    class="px-5 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors shadow-sm">
                                <span x-text="selectedTransaction ? 'Сохранить' : 'Создать'"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction Details Modal -->
        <div x-show="showTransactionDetailsModal" class="fixed inset-0 z-50">
            <div class="fixed inset-0 bg-black bg-opacity-50"></div>
            <div class="fixed inset-0 flex items-center justify-center p-4">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">Детали транзакции</h3>
                            <button @click="showTransactionDetailsModal = false" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div :class="getTransactionIconClass(selectedTransactionDetails.type)"
                                         class="w-10 h-10 rounded-lg flex items-center justify-center">
                                        <i :data-lucide="getTransactionIcon(selectedTransactionDetails.type)" class="w-5 h-5 text-white"></i>
                                    </div>
                                    <div>
                                        <div class="text-lg font-medium text-gray-900" x-text="selectedTransactionDetails.category"></div>
                                        <div class="text-sm text-gray-500" x-text="selectedTransactionDetails.description || ''"></div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div :class="getAmountClass(selectedTransactionDetails.type)"
                                         class="text-xl font-semibold"
                                         x-text="formatCurrency(selectedTransactionDetails.amount)"></div>
                                    <div class="text-sm text-gray-500" x-text="formatDate(selectedTransactionDetails.date)"></div>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 pt-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <div class="text-sm text-gray-500">Статус</div>
                                        <div class="mt-1">
                                            <span :class="{
                                                'bg-green-100 text-green-800': selectedTransactionDetails.status === 'completed',
                                                'bg-yellow-100 text-yellow-800': selectedTransactionDetails.status === 'pending'
                                            }"
                                                  class="px-2 py-1 text-xs font-medium rounded-full"
                                                  x-text="selectedTransactionDetails.status === 'completed' ? 'Выполнено' : 'Ожидание'">
                                            </span>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-500">Способ оплаты</div>
                                        <div class="mt-1 text-sm text-gray-900" x-text="selectedTransactionDetails.paymentMethod"></div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-500">Клиент/Поставщик</div>
                                        <div class="mt-1 text-sm text-gray-900" x-text="selectedTransactionDetails.client || selectedTransactionDetails.provider || selectedTransactionDetails.employee || selectedTransactionDetails.landlord"></div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-500">Дата</div>
                                        <div class="mt-1 text-sm text-gray-900" x-text="formatDate(selectedTransactionDetails.date)"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 pt-4">
                                <div class="text-sm text-gray-500">Примечания</div>
                                <div class="mt-1 text-sm text-gray-900" x-text="selectedTransactionDetails.notes"></div>
                            </div>
                        </div>

                        <div class="mt-6 flex justify-end space-x-3">
                            <button @click="showTransactionDetailsModal = false"
                                    class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                Закрыть
                            </button>
                            <button @click="editTransaction(selectedTransactionDetails)"
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Редактировать
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div x-show="toast" class="fixed top-4 right-4 z-50">
            <div :class="{'bg-green-500': toast.type === 'success', 'bg-red-500': toast.type === 'error'}"
                 class="px-4 py-3 rounded-lg shadow-lg text-white">
                <span x-text="toast.message"></span>
            </div>
        </div>
    </div>

    <!-- Alpine.js Logic -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('finances', () => ({
                view: 'overview',
                showTransactionModal: false,
                showTransactionDetailsModal: false,
                selectedTransaction: null,
                selectedTransactionDetails: null,
                searchQuery: '',
                selectedType: 'all',
                selectedCategory: 'all',
                selectedPeriod: 'month',
                toast: null,
                isNavCollapsed: false,
                isStatsCollapsed: false,
                isFiltersCollapsed: false,
                selectedReportPeriod: 'month',
                transactionForm: {
                    type: 'income',
                    category: 'services',
                    amount: 0,
                    description: '',
                    date: new Date().toISOString().split('T')[0],
                    client: '',
                    paymentMethod: 'cash',
                    tags: [],
                    recurring: 'none',
                    status: 'completed'
                },
                transactions: [
                    {
                        id: 1,
                        type: 'income',
                        status: 'completed',
                        category: 'services',
                        amount: 150000,
                        description: 'Оплата услуг стрижки',
                        date: '2024-03-20',
                        client: 'Иван Петров',
                        paymentMethod: 'Наличные',
                        notes: 'Стрижка + окрашивание'
                    },
                    {
                        id: 2,
                        type: 'expense',
                        status: 'completed',
                        category: 'salary',
                        amount: 85000,
                        description: 'Зарплата сотрудникам',
                        date: '2024-03-19',
                        employee: 'Анна Сидорова',
                        paymentMethod: 'Банковский перевод',
                        notes: 'Мартовская зарплата'
                    },
                    {
                        id: 3,
                        type: 'expense',
                        status: 'completed',
                        category: 'rent',
                        amount: 45000,
                        description: 'Аренда помещения',
                        date: '2024-03-18',
                        landlord: 'ООО "Рента"',
                        paymentMethod: 'Банковский перевод',
                        notes: 'Аренда за март'
                    },
                    {
                        id: 4,
                        type: 'expense',
                        status: 'completed',
                        category: 'utilities',
                        amount: 15000,
                        description: 'Коммунальные услуги',
                        date: '2024-03-17',
                        provider: 'Энергосбыт',
                        paymentMethod: 'Банковский перевод',
                        notes: 'Электроэнергия за февраль'
                    },
                    {
                        id: 5,
                        type: 'income',
                        status: 'completed',
                        category: 'products',
                        amount: 25000,
                        description: 'Продажа товаров',
                        date: '2024-03-16',
                        client: 'Мария Иванова',
                        paymentMethod: 'Карта',
                        notes: 'Шампунь + кондиционер'
                    },
                    {
                        id: 6,
                        type: 'income',
                        status: 'pending',
                        category: 'services',
                        amount: 35000,
                        description: 'Ожидаемая оплата за услуги',
                        date: '2024-03-25',
                        client: 'Алексей Смирнов',
                        paymentMethod: 'Банковский перевод',
                        notes: 'Предоплата за комплекс услуг'
                    },
                    {
                        id: 7,
                        type: 'expense',
                        status: 'pending',
                        category: 'utilities',
                        amount: 12000,
                        description: 'Ожидаемый платеж за воду',
                        date: '2024-03-24',
                        provider: 'Водоканал',
                        paymentMethod: 'Банковский перевод',
                        notes: 'Водоснабжение за февраль'
                    },
                    {
                        id: 8,
                        type: 'income',
                        status: 'completed',
                        category: 'services',
                        amount: 45000,
                        description: 'Комплексный уход',
                        date: '2024-03-15',
                        client: 'Елена Козлова',
                        paymentMethod: 'Карта',
                        notes: 'Стрижка + окрашивание + укладка'
                    }
                ],

                init() {
                    this.initializeCharts();
                },

                initializeCharts() {
                    // Income vs Expenses Chart
                    const incomeExpensesCtx = document.getElementById('incomeExpensesChart').getContext('2d');
                    const gradientIncome = incomeExpensesCtx.createLinearGradient(0, 0, 0, 400);
                    gradientIncome.addColorStop(0, 'rgba(16, 185, 129, 0.2)');
                    gradientIncome.addColorStop(1, 'rgba(16, 185, 129, 0)');

                    const gradientExpense = incomeExpensesCtx.createLinearGradient(0, 0, 0, 400);
                    gradientExpense.addColorStop(0, 'rgba(239, 68, 68, 0.2)');
                    gradientExpense.addColorStop(1, 'rgba(239, 68, 68, 0)');

                    new Chart(incomeExpensesCtx, {
                        type: 'line',
                        data: {
                            labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн'],
                            datasets: [
                                {
                                    label: 'Доходы',
                                    data: [120000, 150000, 180000, 160000, 200000, 220000],
                                    borderColor: '#10B981',
                                    backgroundColor: gradientIncome,
                                    tension: 0.4,
                                    fill: true,
                                    borderWidth: 3,
                                    pointBackgroundColor: '#10B981',
                                    pointBorderColor: '#fff',
                                    pointBorderWidth: 2,
                                    pointRadius: 6,
                                    pointHoverRadius: 10,
                                    pointHoverBackgroundColor: '#10B981',
                                    pointHoverBorderColor: '#fff',
                                    pointHoverBorderWidth: 3,
                                    pointHoverShadowColor: 'rgba(16, 185, 129, 0.5)',
                                    pointHoverShadowBlur: 15
                                },
                                {
                                    label: 'Расходы',
                                    data: [80000, 95000, 110000, 100000, 120000, 130000],
                                    borderColor: '#EF4444',
                                    backgroundColor: gradientExpense,
                                    tension: 0.4,
                                    fill: true,
                                    borderWidth: 3,
                                    pointBackgroundColor: '#EF4444',
                                    pointBorderColor: '#fff',
                                    pointBorderWidth: 2,
                                    pointRadius: 6,
                                    pointHoverRadius: 10,
                                    pointHoverBackgroundColor: '#EF4444',
                                    pointHoverBorderColor: '#fff',
                                    pointHoverBorderWidth: 3,
                                    pointHoverShadowColor: 'rgba(239, 68, 68, 0.5)',
                                    pointHoverShadowBlur: 15
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 2000,
                                easing: 'easeInOutQuart'
                            },
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                    titleColor: '#1F2937',
                                    bodyColor: '#1F2937',
                                    borderColor: '#E5E7EB',
                                    borderWidth: 1,
                                    padding: 12,
                                    boxPadding: 6,
                                    usePointStyle: true,
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: ${new Intl.NumberFormat('ru-RU', {
                                                style: 'currency',
                                                currency: 'KGS',
                                                maximumFractionDigits: 0
                                            }).format(context.raw)}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.05)',
                                        drawBorder: false
                                    },
                                    ticks: {
                                        callback: function(value) {
                                            return new Intl.NumberFormat('ru-RU', {
                                                style: 'currency',
                                                currency: 'KGS',
                                                maximumFractionDigits: 0
                                            }).format(value);
                                        },
                                        padding: 10,
                                        color: '#6B7280',
                                        font: {
                                            size: 12
                                        }
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    },
                                    ticks: {
                                        padding: 10,
                                        color: '#6B7280',
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Categories Chart
                    const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
                    const categoriesGradient = categoriesCtx.createRadialGradient(0, 0, 0, 0, 0, 150);
                    categoriesGradient.addColorStop(0, 'rgba(59, 130, 246, 0.8)');
                    categoriesGradient.addColorStop(1, 'rgba(59, 130, 246, 0.2)');

                    new Chart(categoriesCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Услуги', 'Товары', 'Зарплата', 'Аренда', 'Коммунальные услуги'],
                            datasets: [{
                                data: [40, 20, 25, 10, 5],
                                backgroundColor: [
                                    '#3B82F6',
                                    '#10B981',
                                    '#F59E0B',
                                    '#EF4444',
                                    '#8B5CF6'
                                ],
                                borderWidth: 0,
                                borderRadius: 0,
                                hoverOffset: 15,
                                hoverBorderWidth: 2,
                                hoverBorderColor: '#fff',
                                hoverShadowColor: 'rgba(0, 0, 0, 0.3)',
                                hoverShadowBlur: 20,
                                hoverShadowOffsetX: 0,
                                hoverShadowOffsetY: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 2000,
                                easing: 'easeInOutQuart'
                            },
                            cutout: '65%',
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        boxWidth: 12,
                                        padding: 15,
                                        color: '#6B7280',
                                        font: {
                                            size: 12
                                        }
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                    titleColor: '#1F2937',
                                    bodyColor: '#1F2937',
                                    borderColor: '#E5E7EB',
                                    borderWidth: 1,
                                    padding: 12,
                                    boxPadding: 6,
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.label}: ${context.raw}%`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Monthly Report Chart
                    const monthlyReportCtx = document.getElementById('monthlyReportChart').getContext('2d');
                    new Chart(monthlyReportCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн'],
                            datasets: [{
                                label: 'Прибыль',
                                data: [40000, 55000, 70000, 60000, 80000, 90000],
                                backgroundColor: '#3B82F6',
                                borderRadius: 6,
                                borderSkipped: false
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 2000,
                                easing: 'easeInOutQuart'
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                    titleColor: '#1F2937',
                                    bodyColor: '#1F2937',
                                    borderColor: '#E5E7EB',
                                    borderWidth: 1,
                                    padding: 12,
                                    boxPadding: 6,
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: ${new Intl.NumberFormat('ru-RU', {
                                                style: 'currency',
                                                currency: 'KGS',
                                                maximumFractionDigits: 0
                                            }).format(context.raw)}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.05)',
                                        drawBorder: false
                                    },
                                    ticks: {
                                        callback: function(value) {
                                            return new Intl.NumberFormat('ru-RU', {
                                                style: 'currency',
                                                currency: 'KGS',
                                                maximumFractionDigits: 0
                                            }).format(value);
                                        },
                                        padding: 10,
                                        color: '#6B7280'
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    },
                                    ticks: {
                                        padding: 10,
                                        color: '#6B7280'
                                    }
                                }
                            }
                        }
                    });

                    // Category Report Chart
                    const categoryReportCtx = document.getElementById('categoryReportChart').getContext('2d');
                    const categoryReportGradient = categoryReportCtx.createRadialGradient(0, 0, 0, 0, 0, 150);
                    categoryReportGradient.addColorStop(0, 'rgba(59, 130, 246, 0.8)');
                    categoryReportGradient.addColorStop(1, 'rgba(59, 130, 246, 0.2)');

                    new Chart(categoryReportCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Услуги', 'Товары', 'Зарплата', 'Аренда', 'Коммунальные услуги'],
                            datasets: [{
                                data: [40, 20, 25, 10, 5],
                                backgroundColor: [
                                    '#3B82F6',
                                    '#10B981',
                                    '#F59E0B',
                                    '#EF4444',
                                    '#8B5CF6'
                                ],
                                borderWidth: 0,
                                borderRadius: 8,
                                hoverOffset: 15,
                                hoverBorderWidth: 2,
                                hoverBorderColor: '#fff',
                                hoverShadowColor: 'rgba(0, 0, 0, 0.2)',
                                hoverShadowBlur: 10
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 2000,
                                easing: 'easeInOutQuart'
                            },
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        boxWidth: 12,
                                        padding: 15,
                                        color: '#6B7280',
                                        font: {
                                            size: 12
                                        }
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                    titleColor: '#1F2937',
                                    bodyColor: '#1F2937',
                                    borderColor: '#E5E7EB',
                                    borderWidth: 1,
                                    padding: 12,
                                    boxPadding: 6,
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.label}: ${context.raw}%`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                },

                get filteredTransactions() {
                    return this.transactions.filter(transaction => {
                        const matchesSearch = !this.searchQuery || 
                            transaction.description.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                            transaction.category.toLowerCase().includes(this.searchQuery.toLowerCase());
                        
                        const matchesType = this.selectedType === 'all' || 
                            transaction.type === this.selectedType;
                        
                        const matchesCategory = this.selectedCategory === 'all' || 
                            transaction.category === this.selectedCategory;
                        
                        return matchesSearch && matchesType && matchesCategory;
                    });
                },

                get recentTransactions() {
                    return this.transactions.slice(0, 5);
                },

                getMonthlyIncome() {
                    return this.transactions
                        .filter(t => t.type === 'income' && t.status === 'completed')
                        .reduce((sum, t) => sum + t.amount, 0);
                },

                getMonthlyExpenses() {
                    return this.transactions
                        .filter(t => t.type === 'expense' && t.status === 'completed')
                        .reduce((sum, t) => sum + t.amount, 0);
                },

                getMonthlyProfit() {
                    return this.getMonthlyIncome() - this.getMonthlyExpenses();
                },

                getTransactionIcon(type) {
                    return type === 'income' ? 'trending-up' : 'trending-down';
                },

                getTransactionIconClass(type) {
                    return type === 'income' ? 'bg-green-600' : 'bg-red-600';
                },

                getAmountClass(type) {
                    return type === 'income' ? 'text-green-600' : 'text-red-600';
                },

                formatCurrency(amount) {
                    return new Intl.NumberFormat('ru-RU', {
                        style: 'currency',
                        currency: 'KGS'
                    }).format(amount);
                },

                formatDate(date) {
                    return new Date(date).toLocaleDateString('ru-RU', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                },

                setTransactionForm() {
                    if (this.selectedTransaction) {
                        this.transactionForm = { ...this.selectedTransaction };
                    } else {
                        this.transactionForm = {
                            type: 'income',
                            category: 'services',
                            amount: 0,
                            description: '',
                            date: new Date().toISOString().split('T')[0],
                            client: '',
                            paymentMethod: 'cash',
                            tags: [],
                            recurring: 'none',
                            status: 'completed'
                        };
                    }
                },

                saveTransaction() {
                    if (this.selectedTransaction) {
                        const index = this.transactions.findIndex(t => t.id === this.selectedTransaction.id);
                        this.transactions[index] = { 
                            ...this.transactionForm, 
                            id: this.selectedTransaction.id,
                            amount: Number(this.transactionForm.amount)
                        };
                        this.showToast('Транзакция обновлена', 'success');
                    } else {
                        const newTransaction = { 
                            ...this.transactionForm, 
                            id: Date.now(),
                            status: 'completed',
                            amount: Number(this.transactionForm.amount)
                        };
                        this.transactions.push(newTransaction);
                        this.showToast('Транзакция добавлена', 'success');
                    }

                    this.showTransactionModal = false;
                    this.selectedTransaction = null;
                    setTimeout(() => {
                        lucide.createIcons();
                    }, 0);
                },

                showToast(message, type) {
                    this.toast = { message, type };
                    setTimeout(() => this.toast = null, 3000);
                },

                searchTransactions() {
                    // Search is handled by the filteredTransactions computed property
                },

                getTotalBalance() {
                    return this.getTotalIncome() - this.getTotalExpenses();
                },

                getTotalIncome() {
                    return this.transactions
                        .filter(t => t.type === 'income' && t.status === 'completed')
                        .reduce((sum, t) => sum + t.amount, 0);
                },

                getTotalExpenses() {
                    return this.transactions
                        .filter(t => t.type === 'expense' && t.status === 'completed')
                        .reduce((sum, t) => sum + t.amount, 0);
                },

                editTransaction(transaction) {
                    this.selectedTransaction = transaction;
                    this.setTransactionForm();
                    this.showTransactionModal = true;
                    this.showTransactionDetailsModal = false;
                },

                deleteTransaction(id) {
                    if (confirm('Вы уверены, что хотите удалить эту запись?')) {
                        this.transactions = this.transactions.filter(t => t.id !== id);
                        this.showToast('Запись удалена', 'success');
                    }
                },

                viewTransactionDetails(transaction) {
                    this.selectedTransactionDetails = transaction;
                    this.showTransactionDetailsModal = true;
                    setTimeout(() => {
                        lucide.createIcons();
                    }, 0);
                },

                toggleTag(tag) {
                    if (!this.transactionForm.tags) {
                        this.transactionForm.tags = [];
                    }
                    const index = this.transactionForm.tags.indexOf(tag);
                    if (index === -1) {
                        this.transactionForm.tags.push(tag);
                    } else {
                        this.transactionForm.tags.splice(index, 1);
                    }
                },

                getReportIncome() {
                    return this.transactions
                        .filter(t => t.type === 'income' && t.status === 'completed')
                        .reduce((sum, t) => sum + t.amount, 0);
                },

                getReportExpenses() {
                    return this.transactions
                        .filter(t => t.type === 'expense' && t.status === 'completed')
                        .reduce((sum, t) => sum + t.amount, 0);
                },

                getReportProfit() {
                    return this.getReportIncome() - this.getReportExpenses();
                },

                getIncomeChange() {
                    // Здесь должна быть логика сравнения с предыдущим периодом
                    return '+15';
                },

                getExpensesChange() {
                    // Здесь должна быть логика сравнения с предыдущим периодом
                    return '-8';
                },

                getProfitChange() {
                    // Здесь должна быть логика сравнения с предыдущим периодом
                    return '+25';
                },

                getTopIncomeSources() {
                    const incomeByCategory = {};
                    this.transactions
                        .filter(t => t.type === 'income' && t.status === 'completed')
                        .forEach(t => {
                            if (!incomeByCategory[t.category]) {
                                incomeByCategory[t.category] = { amount: 0, count: 0 };
                            }
                            incomeByCategory[t.category].amount += t.amount;
                            incomeByCategory[t.category].count += 1;
                        });

                    return Object.entries(incomeByCategory)
                        .map(([category, data]) => ({
                            category,
                            amount: data.amount,
                            count: data.count
                        }))
                        .sort((a, b) => b.amount - a.amount)
                        .slice(0, 5);
                },

                getTopExpenses() {
                    return this.transactions
                        .filter(t => t.type === 'expense' && t.status === 'completed')
                        .sort((a, b) => b.amount - a.amount)
                        .slice(0, 5);
                },

                getProfitability() {
                    const income = this.getReportIncome();
                    const profit = this.getReportProfit();
                    return income ? Math.round((profit / income) * 100) : 0;
                },

                getAverageCheck() {
                    const completedTransactions = this.transactions.filter(t => t.status === 'completed');
                    const totalAmount = completedTransactions.reduce((sum, t) => sum + t.amount, 0);
                    return completedTransactions.length ? Math.round(totalAmount / completedTransactions.length) : 0;
                },

                getTransactionCount() {
                    return this.transactions.filter(t => t.status === 'completed').length;
                },

                getGrowthRate() {
                    // Здесь должна быть логика расчета темпа роста
                    return '+12';
                },

                exportReport() {
                    // Здесь должна быть логика экспорта отчета
                    this.showToast('Отчет экспортирован', 'success');
                },

                aiInsights: {
                    spending: [
                        {
                            icon: 'alert-circle',
                            message: 'Высокие расходы на коммунальные услуги',
                            details: 'Ваши расходы на коммунальные услуги на 15% выше среднего по отрасли. Рекомендуем проверить тарифы и рассмотреть возможность оптимизации.'
                        },
                        {
                            icon: 'trending-down',
                            message: 'Снижение расходов на зарплату',
                            details: 'За последний месяц расходы на зарплату снизились на 8%. Это может быть связано с сезонностью или требует внимания.'
                        }
                    ],
                    income: [
                        {
                            icon: 'trending-up',
                            message: 'Потенциал роста доходов от услуг',
                            details: 'Ваши услуги пользуются высоким спросом. Рекомендуем рассмотреть возможность повышения цен на 5-10%.'
                        },
                        {
                            icon: 'users',
                            message: 'Расширение клиентской базы',
                            details: 'Анализ показывает, что вы можете увеличить доход на 20% за счет привлечения новых клиентов.'
                        }
                    ],
                    health: [
                        {
                            icon: 'check-circle',
                            message: 'Хорошая финансовая стабильность',
                            details: 'Ваш бизнес демонстрирует стабильный рост и здоровые финансовые показатели.'
                        },
                        {
                            icon: 'alert-triangle',
                            message: 'Резервный фонд',
                            details: 'Рекомендуем создать резервный фонд в размере 3-6 месячных расходов для обеспечения финансовой безопасности.'
                        }
                    ],
                    growth: [
                        {
                            icon: 'plus-circle',
                            message: 'Новые направления услуг',
                            details: 'На основе анализа рынка, рекомендуем рассмотреть добавление новых услуг в ваше предложение.'
                        },
                        {
                            icon: 'target',
                            message: 'Оптимизация рабочего процесса',
                            details: 'Внедрение новых технологий может увеличить эффективность работы на 25%.'
                        }
                    ]
                },

                refreshAIAdvice() {
                    // Здесь будет логика обновления ИИ советов
                    this.showToast('Советы обновлены', 'success');
                }
            }));
        });

        // Initialize Lucide Icons
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
</body>
</html> 