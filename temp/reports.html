<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resso Reports & Analytics</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .sidebar {
            width: 280px;
            transition: all 0.3s ease;
        }
        .sidebar.collapsed {
            width: 80px;
        }
        .main-content {
            transition: all 0.3s ease;
            margin-left: 280px;
        }
        .main-content.expanded {
            margin-left: 80px;
        }
        .header-content {
            transition: all 0.3s ease;
            margin-left: 280px;
        }
        .header-content.expanded {
            margin-left: 80px;
        }
    </style>
</head>
<body class="h-screen bg-gray-50 flex" style="font-family: system-ui, -apple-system, sans-serif;">
    <div x-data="ressoReports()">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-gray-200 p-4 space-y-6 fixed left-0 top-16 bottom-0 overflow-y-auto no-scrollbar z-40" x-data="{ isNavCollapsed: false, isStatsCollapsed: false }">
            <!-- Навигация -->
            <div>
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-sm font-medium text-gray-900">Навигация</h3>
                    <button @click="isNavCollapsed = !isNavCollapsed"
                            class="text-gray-500 hover:text-blue-600 transition-colors duration-200 p-1 rounded-lg hover:bg-blue-50">
                        <i data-lucide="chevron-down"
                           class="w-5 h-5 transition-all duration-300 ease-in-out"
                           :class="{'rotate-180': isNavCollapsed}"></i>
                    </button>
                </div>
                <div class="space-y-1 overflow-hidden transition-all duration-300 ease-in-out"
                     :class="{'max-h-0 opacity-0': isNavCollapsed, 'max-h-[500px] opacity-100': !isNavCollapsed}">
                    <a href="index.html" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i data-lucide="home" class="w-4 h-4 flex-shrink-0"></i>
                        <span>Главная</span>
                    </a>
                    <a href="emploee.html" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i data-lucide="users" class="w-4 h-4 flex-shrink-0"></i>
                        <span>Сотрудники</span>
                    </a>
                    <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i data-lucide="user-plus" class="w-4 h-4 flex-shrink-0"></i>
                        <span>Клиенты</span>
                    </a>
                    <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i data-lucide="calendar" class="w-4 h-4 flex-shrink-0"></i>
                        <span>Записи</span>
                    </a>
                    <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i data-lucide="scissors" class="w-4 h-4 flex-shrink-0"></i>
                        <span>Услуги</span>
                    </a>
                    <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i data-lucide="dollar-sign" class="w-4 h-4 flex-shrink-0"></i>
                        <span>Финансы</span>
                    </a>
                    <a href="#" class="flex items-center space-x-2 px-3 py-2 bg-blue-50 text-blue-600 rounded-lg">
                        <i data-lucide="bar-chart-2" class="w-4 h-4 flex-shrink-0"></i>
                        <span>Отчеты</span>
                    </a>
                    <a href="#" class="flex items-center space-x-2 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i data-lucide="settings" class="w-4 h-4 flex-shrink-0"></i>
                        <span>Настройки</span>
                    </a>
                </div>
            </div>

            <!-- Статистика -->
            <div>
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-sm font-medium text-gray-900">Статистика</h3>
                    <button @click="isStatsCollapsed = !isStatsCollapsed"
                            class="text-gray-500 hover:text-blue-600 transition-colors duration-200 p-1 rounded-lg hover:bg-blue-50">
                        <i data-lucide="chevron-down"
                           class="w-5 h-5 transition-all duration-300 ease-in-out"
                           :class="{'rotate-180': isStatsCollapsed}"></i>
                    </button>
                </div>
                <div class="space-y-4 overflow-hidden transition-all duration-300 ease-in-out"
                     :class="{'max-h-0 opacity-0': isStatsCollapsed, 'max-h-[500px] opacity-100': !isStatsCollapsed}">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">Записей сегодня</span>
                            <span class="text-sm font-medium text-gray-900">28</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                            <div class="bg-blue-600 h-1.5 rounded-full" style="width: 75%"></div>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">Новых клиентов</span>
                            <span class="text-sm font-medium text-gray-900">12</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                            <div class="bg-green-600 h-1.5 rounded-full" style="width: 60%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Info -->
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <i data-lucide="user" class="w-4 h-4 text-white"></i>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-gray-900">Администратор</div>
                        <div class="text-xs text-gray-500">admin@resso.com</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-content flex-1">
            <!-- Header -->
            <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between fixed top-0 left-0 right-0 z-30">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">R</span>
                        </div>
                        <span class="font-semibold text-gray-900">Resso</span>
                        <span class="text-gray-400">•</span>
                        <span class="text-gray-600">Отчеты и аналитика</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button @click="period = 'day'"
                                :class="{'bg-white shadow-sm text-blue-600': period === 'day', 'text-gray-600 hover:text-gray-900': period !== 'day'}"
                                class="px-3 py-1 rounded-md text-sm transition-colors">
                            День
                        </button>
                        <button @click="period = 'week'"
                                :class="{'bg-white shadow-sm text-blue-600': period === 'week', 'text-gray-600 hover:text-gray-900': period !== 'week'}"
                                class="px-3 py-1 rounded-md text-sm transition-colors">
                            Неделя
                        </button>
                        <button @click="period = 'month'"
                                :class="{'bg-white shadow-sm text-blue-600': period === 'month', 'text-gray-600 hover:text-gray-900': period !== 'month'}"
                                class="px-3 py-1 rounded-md text-sm transition-colors">
                            Месяц
                        </button>
                    </div>
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                        <input type="text"
                               placeholder="Поиск отчетов..."
                               class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-64"
                               x-model="reportSearch">
                    </div>
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <i data-lucide="user" class="w-4 h-4 text-white"></i>
                    </div>
                </div>
            </header>
            <div class="flex flex-1 overflow-hidden pt-16">
                <main class="flex-1 overflow-auto p-6">
                    <!-- AI Insights -->
                    <div class="bg-white rounded-xl p-6 shadow-sm mb-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">ИИ Аналитика</h3>
                            <button @click="refreshAIInsights" class="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                <span>Обновить</span>
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="trending-up" class="w-5 h-5 text-blue-600"></i>
                                    </div>
                                    <h4 class="text-sm font-medium text-gray-900">Тренды</h4>
                                </div>
                                <p class="text-sm text-gray-600" x-text="aiInsights.trends"></p>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="lightbulb" class="w-5 h-5 text-green-600"></i>
                                    </div>
                                    <h4 class="text-sm font-medium text-gray-900">Рекомендации</h4>
                                </div>
                                <p class="text-sm text-gray-600" x-text="aiInsights.recommendations"></p>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="target" class="w-5 h-5 text-purple-600"></i>
                                    </div>
                                    <h4 class="text-sm font-medium text-gray-900">Прогноз</h4>
                                </div>
                                <p class="text-sm text-gray-600" x-text="aiInsights.forecast"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-gray-500">Общая выручка</h3>
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="credit-card" class="w-5 h-5 text-blue-600"></i>
                                </div>
                            </div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="formatCurrency(totalRevenue)"></div>
                            <div class="flex items-center mt-2">
                                <span :class="{'text-green-500': revenueChange > 0, 'text-red-500': revenueChange < 0}"
                                      class="text-sm font-medium" x-text="formatChange(revenueChange)"></span>
                                <span class="text-sm text-gray-500 ml-2">vs прошлый период</span>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-gray-500">Количество записей</h3>
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="calendar" class="w-5 h-5 text-green-600"></i>
                                </div>
                            </div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="totalBookings"></div>
                            <div class="flex items-center mt-2">
                                <span :class="{'text-green-500': bookingsChange > 0, 'text-red-500': bookingsChange < 0}"
                                      class="text-sm font-medium" x-text="formatChange(bookingsChange)"></span>
                                <span class="text-sm text-gray-500 ml-2">vs прошлый период</span>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-gray-500">Средний чек</h3>
                                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="receipt" class="w-5 h-5 text-purple-600"></i>
                                </div>
                            </div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="formatCurrency(averageCheck)"></div>
                            <div class="flex items-center mt-2">
                                <span :class="{'text-green-500': averageCheckChange > 0, 'text-red-500': averageCheckChange < 0}"
                                      class="text-sm font-medium" x-text="formatChange(averageCheckChange)"></span>
                                <span class="text-sm text-gray-500 ml-2">vs прошлый период</span>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-gray-500">Загруженность</h3>
                                <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="users" class="w-5 h-5 text-orange-600"></i>
                                </div>
                            </div>
                            <div class="text-2xl font-semibold text-gray-900" x-text="occupancyRate + '%'"></div>
                            <div class="flex items-center mt-2">
                                <span :class="{'text-green-500': occupancyChange > 0, 'text-red-500': occupancyChange < 0}"
                                      class="text-sm font-medium" x-text="formatChange(occupancyChange)"></span>
                                <span class="text-sm text-gray-500 ml-2">vs прошлый период</span>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Revenue Chart -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900">Динамика выручки</h3>
                                <div class="flex space-x-2">
                                    <button @click="revenueChartType = 'line'"
                                            :class="{'bg-blue-100 text-blue-600': revenueChartType === 'line', 'text-gray-600': revenueChartType !== 'line'}"
                                            class="p-2 rounded-lg hover:bg-gray-100">
                                        <i data-lucide="line-chart" class="w-4 h-4"></i>
                                    </button>
                                    <button @click="revenueChartType = 'bar'"
                                            :class="{'bg-blue-100 text-blue-600': revenueChartType === 'bar', 'text-gray-600': revenueChartType !== 'bar'}"
                                            class="p-2 rounded-lg hover:bg-gray-100">
                                        <i data-lucide="bar-chart" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                                    <span class="text-sm text-gray-600">Выручка</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                                    <span class="text-sm text-gray-600">Прибыль</span>
                                </div>
                            </div>
                            <div class="h-80">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>

                        <!-- Services Distribution -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900">Распределение услуг</h3>
                                <div class="flex space-x-2">
                                    <button @click="servicesChartType = 'pie'"
                                            :class="{'bg-blue-100 text-blue-600': servicesChartType === 'pie', 'text-gray-600': servicesChartType !== 'pie'}"
                                            class="p-2 rounded-lg hover:bg-gray-100">
                                        <i data-lucide="pie-chart" class="w-4 h-4"></i>
                                    </button>
                                    <button @click="servicesChartType = 'doughnut'"
                                            :class="{'bg-blue-100 text-blue-600': servicesChartType === 'doughnut', 'text-gray-600': servicesChartType !== 'doughnut'}"
                                            class="p-2 rounded-lg hover:bg-gray-100">
                                        <i data-lucide="circle" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="h-80">
                                <canvas id="servicesChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Analytics -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- Peak Hours -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h3 class="text-lg font-semibold text-gray-900 mb-6">Пиковые часы</h3>
                            <div class="space-y-4">
                                <template x-for="(hour, index) in peakHours" :key="index">
                                    <div>
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="text-sm text-gray-600" x-text="hour.time"></span>
                                            <span class="text-sm font-medium text-gray-900" x-text="hour.bookings + ' записей'"></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-blue-600 h-2 rounded-full" :style="'width: ' + hour.percentage + '%'"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Client Retention -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h3 class="text-lg font-semibold text-gray-900 mb-6">Удержание клиентов</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Новые клиенты</span>
                                    <span class="text-sm font-medium text-gray-900" x-text="newClients"></span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Постоянные клиенты</span>
                                    <span class="text-sm font-medium text-gray-900" x-text="returningClients"></span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Процент возврата</span>
                                    <span class="text-sm font-medium text-gray-900" x-text="retentionRate + '%'"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Popular Services -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h3 class="text-lg font-semibold text-gray-900 mb-6">Популярные услуги</h3>
                            <div class="space-y-4">
                                <template x-for="(service, index) in popularServices" :key="index">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                                                 :style="'background-color: ' + service.color + '20'">
                                                <i :data-lucide="service.icon" class="w-4 h-4" :style="'color: ' + service.color"></i>
                                            </div>
                                            <span class="text-sm text-gray-600" x-text="service.name"></span>
                                        </div>
                                        <span class="text-sm font-medium text-gray-900" x-text="service.count + ' записей'"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Extended Analytics -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Financial Analytics -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900">Финансовая аналитика</h3>
                                <div class="flex space-x-2">
                                    <button @click="financialPeriod = 'week'"
                                            :class="{'bg-blue-100 text-blue-600': financialPeriod === 'week', 'text-gray-600': financialPeriod !== 'week'}"
                                            class="px-3 py-1 rounded-md text-sm transition-colors">
                                        Неделя
                                    </button>
                                    <button @click="financialPeriod = 'month'"
                                            :class="{'bg-blue-100 text-blue-600': financialPeriod === 'month', 'text-gray-600': financialPeriod !== 'month'}"
                                            class="px-3 py-1 rounded-md text-sm transition-colors">
                                        Месяц
                                    </button>
                                </div>
                            </div>
                            <div class="space-y-6">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="text-sm text-gray-600 mb-1">Общая выручка</div>
                                        <div class="text-xl font-semibold text-gray-900" x-text="formatCurrency(financialStats.totalRevenue)"></div>
                                        <div class="text-sm" :class="{'text-green-500': financialStats.revenueChange > 0, 'text-red-500': financialStats.revenueChange < 0}"
                                             x-text="formatChange(financialStats.revenueChange)"></div>
                                    </div>
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="text-sm text-gray-600 mb-1">Чистая прибыль</div>
                                        <div class="text-xl font-semibold text-gray-900" x-text="formatCurrency(financialStats.netProfit)"></div>
                                        <div class="text-sm" :class="{'text-green-500': financialStats.profitChange > 0, 'text-red-500': financialStats.profitChange < 0}"
                                             x-text="formatChange(financialStats.profitChange)"></div>
                                    </div>
                                </div>
                                <div class="h-64">
                                    <canvas id="financialChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Client Analytics -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900">Аналитика клиентов</h3>
                                <div class="flex space-x-2">
                                    <button @click="clientPeriod = 'week'"
                                            :class="{'bg-blue-100 text-blue-600': clientPeriod === 'week', 'text-gray-600': clientPeriod !== 'week'}"
                                            class="px-3 py-1 rounded-md text-sm transition-colors">
                                        Неделя
                                    </button>
                                    <button @click="clientPeriod = 'month'"
                                            :class="{'bg-blue-100 text-blue-600': clientPeriod === 'month', 'text-gray-600': clientPeriod !== 'month'}"
                                            class="px-3 py-1 rounded-md text-sm transition-colors">
                                        Месяц
                                    </button>
                                </div>
                            </div>
                            <div class="space-y-6">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="text-sm text-gray-600 mb-1">Новые клиенты</div>
                                        <div class="text-xl font-semibold text-gray-900" x-text="clientStats.newClients"></div>
                                        <div class="text-sm" :class="{'text-green-500': clientStats.newClientsChange > 0, 'text-red-500': clientStats.newClientsChange < 0}"
                                             x-text="formatChange(clientStats.newClientsChange)"></div>
                                    </div>
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="text-sm text-gray-600 mb-1">Повторные визиты</div>
                                        <div class="text-xl font-semibold text-gray-900" x-text="clientStats.returningClients"></div>
                                        <div class="text-sm" :class="{'text-green-500': clientStats.returningClientsChange > 0, 'text-red-500': clientStats.returningClientsChange < 0}"
                                             x-text="formatChange(clientStats.returningClientsChange)"></div>
                                    </div>
                                </div>
                                <div class="h-64">
                                    <canvas id="clientChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Analytics -->
                    <div class="bg-white rounded-xl p-6 shadow-sm mb-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">Аналитика услуг</h3>
                            <div class="flex items-center space-x-4">
                                <div class="relative">
                                    <input type="text" 
                                           placeholder="Поиск услуги..." 
                                           class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           x-model="serviceSearch">
                                    <i data-lucide="search" class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"></i>
                                </div>
                                <button @click="exportServiceReport" class="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    <span>Экспорт</span>
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Услуга</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Количество</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Выручка</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Средняя стоимость</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Популярность</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Тренд</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="service in filteredServices" :key="service.id">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                                                         :style="'background-color: ' + service.color + '20'">
                                                        <i :data-lucide="service.icon" class="w-4 h-4" :style="'color: ' + service.color"></i>
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-gray-900" x-text="service.name"></div>
                                                        <div class="text-xs text-gray-500" x-text="service.category"></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" x-text="service.count"></div>
                                                <div class="text-xs text-gray-500" x-text="formatChange(service.countChange)"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" x-text="formatCurrency(service.revenue)"></div>
                                                <div class="text-xs text-gray-500" x-text="formatChange(service.revenueChange)"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" x-text="formatCurrency(service.averagePrice)"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                                        <div class="bg-blue-600 h-2.5 rounded-full" :style="'width: ' + service.popularity + '%'"></div>
                                                    </div>
                                                    <span class="ml-2 text-sm text-gray-500" x-text="service.popularity + '%'"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <template x-if="service.trend === 'up'">
                                                        <i data-lucide="trending-up" class="w-4 h-4 text-green-500"></i>
                                                    </template>
                                                    <template x-if="service.trend === 'down'">
                                                        <i data-lucide="trending-down" class="w-4 h-4 text-red-500"></i>
                                                    </template>
                                                    <template x-if="service.trend === 'stable'">
                                                        <i data-lucide="trending-right" class="w-4 h-4 text-gray-500"></i>
                                                    </template>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Detailed Statistics -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Детальная статистика</h3>
                            <div class="flex items-center space-x-4">
                                <div class="relative">
                                    <input type="text" 
                                           placeholder="Поиск мастера..." 
                                           class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           x-model="masterSearch">
                                    <i data-lucide="search" class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"></i>
                                </div>
                                <button @click="exportToExcel" class="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    <span>Экспорт</span>
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Мастер</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Количество записей</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Выручка</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Средний чек</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Загруженность</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Рейтинг</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="master in filteredMasterStats" :key="master.id">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="w-8 h-8 rounded-full flex items-center justify-center"
                                                         :style="'background-color: ' + master.color + '20'">
                                                        <span class="text-sm font-medium" :style="'color: ' + master.color" x-text="master.name[0]"></span>
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-gray-900" x-text="master.name"></div>
                                                        <div class="text-xs text-gray-500" x-text="master.specialization"></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" x-text="master.bookings"></div>
                                                <div class="text-xs text-gray-500" x-text="'+' + master.newBookings + ' новых'"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" x-text="formatCurrency(master.revenue)"></div>
                                                <div class="text-xs text-gray-500" x-text="formatChange(master.revenueChange)"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" x-text="formatCurrency(master.averageCheck)"></div>
                                                <div class="text-xs text-gray-500" x-text="formatChange(master.averageCheckChange)"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                                        <div class="bg-blue-600 h-2.5 rounded-full" :style="'width: ' + master.occupancy + '%'"></div>
                                                    </div>
                                                    <span class="ml-2 text-sm text-gray-500" x-text="master.occupancy + '%'"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <template x-for="i in 5" :key="i">
                                                        <i data-lucide="star" 
                                                           class="w-4 h-4"
                                                           :class="{'text-yellow-400': i <= master.rating, 'text-gray-300': i > master.rating}"></i>
                                                    </template>
                                                    <span class="ml-2 text-sm text-gray-500" x-text="master.rating + '.0'"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <button @click="showMasterDetails(master)" 
                                                        class="text-blue-600 hover:text-blue-800">
                                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Advanced Analytics -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Customer Segmentation -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900">Сегментация клиентов</h3>
                                <div class="flex space-x-2">
                                    <button @click="segmentationType = 'age'"
                                            :class="{'bg-blue-100 text-blue-600': segmentationType === 'age', 'text-gray-600': segmentationType !== 'age'}"
                                            class="px-3 py-1 rounded-md text-sm transition-colors">
                                        Возраст
                                    </button>
                                    <button @click="segmentationType = 'frequency'"
                                            :class="{'bg-blue-100 text-blue-600': segmentationType === 'frequency', 'text-gray-600': segmentationType !== 'frequency'}"
                                            class="px-3 py-1 rounded-md text-sm transition-colors">
                                        Частота
                                    </button>
                                </div>
                            </div>
                            <div class="h-80">
                                <canvas id="segmentationChart"></canvas>
                            </div>
                        </div>

                        <!-- Revenue Analysis -->
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900">Анализ выручки</h3>
                                <div class="flex space-x-2">
                                    <button @click="revenueAnalysisType = 'daily'"
                                            :class="{'bg-blue-100 text-blue-600': revenueAnalysisType === 'daily', 'text-gray-600': revenueAnalysisType !== 'daily'}"
                                            class="px-3 py-1 rounded-md text-sm transition-colors">
                                        По дням
                                    </button>
                                    <button @click="revenueAnalysisType = 'services'"
                                            :class="{'bg-blue-100 text-blue-600': revenueAnalysisType === 'services', 'text-gray-600': revenueAnalysisType !== 'services'}"
                                            class="px-3 py-1 rounded-md text-sm transition-colors">
                                        По услугам
                                    </button>
                                </div>
                            </div>
                            <div class="h-80">
                                <canvas id="revenueAnalysisChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="bg-white rounded-xl p-6 shadow-sm mb-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">Показатели эффективности</h3>
                            <div class="flex items-center space-x-4">
                                <div class="relative">
                                    <input type="text" 
                                           placeholder="Поиск метрики..." 
                                           class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           x-model="metricSearch">
                                    <i data-lucide="search" class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"></i>
                                </div>
                                <button @click="exportMetrics" class="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    <span>Экспорт</span>
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <template x-for="metric in filteredMetrics" :key="metric.id">
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                                                 :style="'background-color: ' + metric.color + '20'">
                                                <i :data-lucide="metric.icon" class="w-5 h-5" :style="'color: ' + metric.color"></i>
                                            </div>
                                            <h4 class="text-sm font-medium text-gray-900" x-text="metric.name"></h4>
                                        </div>
                                        <div class="text-sm" :class="{'text-green-500': metric.change > 0, 'text-red-500': metric.change < 0}"
                                             x-text="formatChange(metric.change)"></div>
                                    </div>
                                    <div class="text-2xl font-semibold text-gray-900" x-text="metric.value"></div>
                                    <div class="text-sm text-gray-500" x-text="metric.description"></div>
                                </div>
                            </template>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Master Details Modal -->
        <div x-show="showMasterModal" 
             class="fixed inset-0 z-50"
             :class="{'lg:flex lg:items-center lg:justify-center': true}">
            <div class="fixed inset-0 bg-black bg-opacity-50"></div>
            <div class="fixed inset-0 lg:relative lg:inset-auto lg:max-w-4xl lg:w-full lg:mx-4 lg:my-8 bg-white lg:rounded-xl lg:shadow-2xl overflow-hidden">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900" x-text="selectedMaster?.name + ' - Детальная статистика'"></h3>
                        <button @click="showMasterModal = false" class="text-gray-400 hover:text-gray-600">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Performance Metrics -->
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="text-sm font-medium text-gray-900 mb-4">Показатели эффективности</h4>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Выполнено услуг</span>
                                        <span class="text-sm font-medium text-gray-900" x-text="selectedMaster?.completedServices"></span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Среднее время услуги</span>
                                        <span class="text-sm font-medium text-gray-900" x-text="selectedMaster?.averageServiceTime + ' мин'"></span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Процент отмен</span>
                                        <span class="text-sm font-medium text-gray-900" x-text="selectedMaster?.cancellationRate + '%'"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Client Feedback -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="text-sm font-medium text-gray-900 mb-4">Отзывы клиентов</h4>
                                <div class="space-y-4">
                                    <template x-for="(feedback, index) in selectedMaster?.recentFeedback" :key="index">
                                        <div class="border-b border-gray-200 pb-4 last:border-b-0 last:pb-0">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="flex items-center space-x-2">
                                                    <div class="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center">
                                                        <span class="text-xs font-medium text-gray-600" x-text="feedback.clientName[0]"></span>
                                                    </div>
                                                    <span class="text-sm font-medium text-gray-900" x-text="feedback.clientName"></span>
                                                </div>
                                                <div class="flex items-center">
                                                    <template x-for="i in 5" :key="i">
                                                        <i data-lucide="star" 
                                                           class="w-3 h-3"
                                                           :class="{'text-yellow-400': i <= feedback.rating, 'text-gray-300': i > feedback.rating}"></i>
                                                    </template>
                                                </div>
                                            </div>
                                            <p class="text-sm text-gray-600" x-text="feedback.comment"></p>
                                            <span class="text-xs text-gray-500" x-text="feedback.date"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- Service Breakdown -->
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="text-sm font-medium text-gray-900 mb-4">Распределение услуг</h4>
                                <div class="h-64">
                                    <canvas id="masterServicesChart"></canvas>
                                </div>
                            </div>

                            <!-- Revenue Trend -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="text-sm font-medium text-gray-900 mb-4">Динамика выручки</h4>
                                <div class="h-64">
                                    <canvas id="masterRevenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alpine.js Logic -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('ressoReports', () => ({
                currentDate: new Date(2025, 5, 15),
                period: 'week',
                revenueChartType: 'line',
                servicesChartType: 'pie',
                showMasterModal: false,
                selectedMaster: null,
                masterSearch: '',
                
                // Summary statistics
                totalRevenue: 125000,
                revenueChange: 12.5,
                totalBookings: 48,
                bookingsChange: 8.3,
                averageCheck: 2604,
                averageCheckChange: 3.9,
                occupancyRate: 75,
                occupancyChange: 5.2,

                // Peak hours data
                peakHours: [
                    { time: '10:00', bookings: 8, percentage: 100 },
                    { time: '11:00', bookings: 7, percentage: 87.5 },
                    { time: '12:00', bookings: 6, percentage: 75 },
                    { time: '13:00', bookings: 5, percentage: 62.5 },
                    { time: '14:00', bookings: 4, percentage: 50 }
                ],

                // Client retention data
                newClients: 25,
                returningClients: 75,
                retentionRate: 75,

                // Popular services data
                popularServices: [
                    { name: 'Стрижка + Укладка', count: 30, icon: 'scissors', color: '#3D5AFE' },
                    { name: 'Маникюр', count: 25, icon: 'hand', color: '#10B981' },
                    { name: 'Педикюр', count: 15, icon: 'footprints', color: '#F59E0B' },
                    { name: 'Массаж лица', count: 20, icon: 'smile', color: '#EF4444' }
                ],

                // Master statistics
                masterStats: [
                    {
                        id: '1',
                        name: 'Анна Петрова',
                        specialization: 'Парикмахер',
                        color: '#3D5AFE',
                        bookings: 15,
                        newBookings: 5,
                        revenue: 45000,
                        revenueChange: 12.5,
                        averageCheck: 3000,
                        averageCheckChange: 3.9,
                        occupancy: 85,
                        rating: 4.8,
                        completedServices: 150,
                        averageServiceTime: 45,
                        cancellationRate: 5,
                        recentFeedback: [
                            {
                                clientName: 'Мария К.',
                                rating: 5,
                                comment: 'Отличный мастер, очень довольна результатом!',
                                date: '15.06.2025'
                            },
                            {
                                clientName: 'Анна С.',
                                rating: 4,
                                comment: 'Хорошая работа, но пришлось немного подождать.',
                                date: '14.06.2025'
                            }
                        ]
                    },
                    {
                        id: '2',
                        name: 'Мария Иванова',
                        specialization: 'Мастер маникюра',
                        color: '#10B981',
                        bookings: 12,
                        newBookings: 3,
                        revenue: 36000,
                        revenueChange: 8.3,
                        averageCheck: 3000,
                        averageCheckChange: 2.1,
                        occupancy: 75,
                        rating: 4.9,
                        completedServices: 120,
                        averageServiceTime: 60,
                        cancellationRate: 3,
                        recentFeedback: [
                            {
                                clientName: 'Елена В.',
                                rating: 5,
                                comment: 'Лучший мастер маникюра!',
                                date: '15.06.2025'
                            }
                        ]
                    },
                    {
                        id: '3',
                        name: 'Елена Сидорова',
                        specialization: 'Косметолог',
                        color: '#F59E0B',
                        bookings: 21,
                        newBookings: 8,
                        revenue: 44000,
                        revenueChange: 15.7,
                        averageCheck: 2095,
                        averageCheckChange: 5.2,
                        occupancy: 65,
                        rating: 4.7,
                        completedServices: 180,
                        averageServiceTime: 90,
                        cancellationRate: 7,
                        recentFeedback: [
                            {
                                clientName: 'Ольга М.',
                                rating: 5,
                                comment: 'Профессионал своего дела!',
                                date: '15.06.2025'
                            }
                        ]
                    }
                ],

                get filteredMasterStats() {
                    if (!this.masterSearch) return this.masterStats;
                    const search = this.masterSearch.toLowerCase();
                    return this.masterStats.filter(master => 
                        master.name.toLowerCase().includes(search) ||
                        master.specialization.toLowerCase().includes(search)
                    );
                },

                formatDate(date) {
                    return new Intl.DateTimeFormat('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' }).format(date);
                },

                formatCurrency(value) {
                    return new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'KGS' }).format(value);
                },

                formatChange(value) {
                    const sign = value > 0 ? '+' : '';
                    return `${sign}${value}%`;
                },

                changeDate(delta) {
                    const newDate = new Date(this.currentDate);
                    const increment = this.period === 'week' ? 7 : this.period === 'month' ? 30 : 1;
                    newDate.setDate(newDate.getDate() + delta * increment);
                    this.currentDate = newDate;
                    this.updateCharts();
                },

                showMasterDetails(master) {
                    this.selectedMaster = master;
                    this.showMasterModal = true;
                    this.$nextTick(() => {
                        this.initMasterCharts();
                    });
                },

                initMasterCharts() {
                    // Master Services Chart
                    const servicesCtx = document.getElementById('masterServicesChart').getContext('2d');
                    new Chart(servicesCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Стрижка', 'Окрашивание', 'Укладка', 'Маникюр'],
                            datasets: [{
                                data: [30, 25, 20, 25],
                                backgroundColor: ['#3D5AFE', '#10B981', '#F59E0B', '#EF4444']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right'
                                }
                            }
                        }
                    });

                    // Master Revenue Chart
                    const revenueCtx = document.getElementById('masterRevenueChart').getContext('2d');
                    new Chart(revenueCtx, {
                        type: 'line',
                        data: {
                            labels: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
                            datasets: [{
                                label: 'Выручка',
                                data: [15000, 18000, 22000, 19000, 25000, 30000, 28000],
                                borderColor: '#3D5AFE',
                                backgroundColor: '#3D5AFE20',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: value => this.formatCurrency(value)
                                    }
                                }
                            }
                        }
                    });
                },

                exportToExcel() {
                    // Here would be the actual export logic
                    this.showToast('Отчет экспортирован', 'success');
                },

                showToast(message, type) {
                    // Implementation of toast notification
                },

                init() {
                    this.initCharts();
                },

                initCharts() {
                    // Revenue Chart
                    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
                    this.revenueChart = new Chart(revenueCtx, {
                        type: this.revenueChartType,
                        data: {
                            labels: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
                            datasets: [{
                                label: 'Выручка',
                                data: [15000, 18000, 22000, 19000, 25000, 30000, 28000],
                                borderColor: '#3D5AFE',
                                backgroundColor: '#3D5AFE20',
                                tension: 0.4
                            },
                            {
                                label: 'Прибыль',
                                data: [12000, 15000, 18000, 16000, 20000, 24000, 22000],
                                borderColor: '#10B981',
                                backgroundColor: '#10B98120',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: value => this.formatCurrency(value)
                                    }
                                }
                            }
                        }
                    });

                    // Services Chart
                    const servicesCtx = document.getElementById('servicesChart').getContext('2d');
                    this.servicesChart = new Chart(servicesCtx, {
                        type: this.servicesChartType,
                        data: {
                            labels: ['Стрижка + Укладка', 'Маникюр', 'Педикюр', 'Массаж лица', 'Окрашивание'],
                            datasets: [{
                                data: [30, 25, 15, 20, 10],
                                backgroundColor: [
                                    '#3D5AFE',
                                    '#10B981',
                                    '#F59E0B',
                                    '#EF4444',
                                    '#8B5CF6'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right'
                                }
                            }
                        }
                    });
                },

                updateCharts() {
                    // Update charts with new data based on selected period
                    // This would typically involve fetching new data from the server
                },

                // Financial Analytics Data
                financialPeriod: 'week',
                financialStats: {
                    totalRevenue: 450000,
                    revenueChange: 15.5,
                    netProfit: 180000,
                    profitChange: 12.3
                },

                // Client Analytics Data
                clientPeriod: 'week',
                clientStats: {
                    newClients: 45,
                    newClientsChange: 8.5,
                    returningClients: 120,
                    returningClientsChange: 12.3
                },

                // Service Analytics Data
                serviceSearch: '',
                services: [
                    {
                        id: 1,
                        name: 'Стрижка + Укладка',
                        category: 'Парикмахерские услуги',
                        icon: 'scissors',
                        color: '#3D5AFE',
                        count: 150,
                        countChange: 12.5,
                        revenue: 450000,
                        revenueChange: 15.3,
                        averagePrice: 3000,
                        popularity: 85,
                        trend: 'up'
                    },
                    {
                        id: 2,
                        name: 'Маникюр',
                        category: 'Ногтевой сервис',
                        icon: 'hand',
                        color: '#10B981',
                        count: 200,
                        countChange: 8.3,
                        revenue: 400000,
                        revenueChange: 10.2,
                        averagePrice: 2000,
                        popularity: 90,
                        trend: 'up'
                    },
                    {
                        id: 3,
                        name: 'Педикюр',
                        category: 'Ногтевой сервис',
                        icon: 'footprints',
                        color: '#F59E0B',
                        count: 120,
                        countChange: -5.2,
                        revenue: 240000,
                        revenueChange: -3.1,
                        averagePrice: 2000,
                        popularity: 75,
                        trend: 'down'
                    },
                    {
                        id: 4,
                        name: 'Массаж лица',
                        category: 'Косметология',
                        icon: 'smile',
                        color: '#EF4444',
                        count: 80,
                        countChange: 0,
                        revenue: 320000,
                        revenueChange: 2.5,
                        averagePrice: 4000,
                        popularity: 65,
                        trend: 'stable'
                    }
                ],

                get filteredServices() {
                    if (!this.serviceSearch) return this.services;
                    const search = this.serviceSearch.toLowerCase();
                    return this.services.filter(service => 
                        service.name.toLowerCase().includes(search) ||
                        service.category.toLowerCase().includes(search)
                    );
                },

                exportServiceReport() {
                    // Here would be the actual export logic
                    this.showToast('Отчет по услугам экспортирован', 'success');
                },

                initFinancialChart() {
                    const ctx = document.getElementById('financialChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
                            datasets: [
                                {
                                    label: 'Выручка',
                                    data: [45000, 52000, 48000, 55000, 60000, 65000, 70000],
                                    borderColor: '#3D5AFE',
                                    backgroundColor: '#3D5AFE20',
                                    tension: 0.4
                                },
                                {
                                    label: 'Прибыль',
                                    data: [18000, 21000, 19000, 22000, 24000, 26000, 28000],
                                    borderColor: '#10B981',
                                    backgroundColor: '#10B98120',
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: value => this.formatCurrency(value)
                                    }
                                }
                            }
                        }
                    });
                },

                initClientChart() {
                    const ctx = document.getElementById('clientChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
                            datasets: [
                                {
                                    label: 'Новые клиенты',
                                    data: [5, 7, 6, 8, 9, 10, 12],
                                    backgroundColor: '#3D5AFE'
                                },
                                {
                                    label: 'Повторные визиты',
                                    data: [15, 18, 16, 20, 22, 25, 28],
                                    backgroundColor: '#10B981'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                },

                // Sidebar state
                isSidebarCollapsed: false,
                currentPage: 'reports',
                menuItems: [
                    { id: 'dashboard', name: 'Панель управления', icon: 'layout-dashboard', href: '#' },
                    { id: 'reports', name: 'Отчеты', icon: 'bar-chart-2', href: '#' },
                    { id: 'bookings', name: 'Записи', icon: 'calendar', href: '#' },
                    { id: 'clients', name: 'Клиенты', icon: 'users', href: '#' },
                    { id: 'services', name: 'Услуги', icon: 'scissors', href: '#' },
                    { id: 'staff', name: 'Сотрудники', icon: 'user-check', href: '#' },
                    { id: 'settings', name: 'Настройки', icon: 'settings', href: '#' }
                ],

                // AI Insights
                aiInsights: {
                    trends: 'Наблюдается рост популярности услуг маникюра и педикюра на 15% по сравнению с прошлым месяцем. Стрижка и окрашивание остаются стабильно востребованными.',
                    recommendations: 'Рекомендуется увеличить количество мастеров в вечернее время, так как наблюдается высокий спрос. Также стоит рассмотреть введение новых услуг по уходу за лицом.',
                    forecast: 'Прогнозируется рост выручки на 20% в следующем месяце. Основной рост ожидается в категории косметологических услуг.'
                },

                // Customer Segmentation
                segmentationType: 'age',
                segmentationData: {
                    age: {
                        labels: ['18-24', '25-34', '35-44', '45-54', '55+'],
                        data: [25, 35, 20, 15, 5]
                    },
                    frequency: {
                        labels: ['Раз в месяц', 'Раз в 2-3 месяца', 'Раз в полгода', 'Раз в год'],
                        data: [40, 30, 20, 10]
                    }
                },

                // Revenue Analysis
                revenueAnalysisType: 'daily',
                revenueAnalysisData: {
                    daily: {
                        labels: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
                        data: [45000, 52000, 48000, 55000, 60000, 65000, 70000]
                    },
                    services: {
                        labels: ['Стрижка', 'Маникюр', 'Педикюр', 'Массаж', 'Косметология'],
                        data: [150000, 200000, 120000, 180000, 250000]
                    }
                },

                // Performance Metrics
                metricSearch: '',
                metrics: [
                    {
                        id: 1,
                        name: 'Конверсия',
                        value: '65%',
                        change: 5.2,
                        icon: 'trending-up',
                        color: '#3D5AFE',
                        description: 'Процент конверсии из просмотров в записи'
                    },
                    {
                        id: 2,
                        name: 'Среднее время услуги',
                        value: '45 мин',
                        change: -2.1,
                        icon: 'clock',
                        color: '#10B981',
                        description: 'Среднее время оказания услуги'
                    },
                    {
                        id: 3,
                        name: 'Отмены',
                        value: '8%',
                        change: -1.5,
                        icon: 'x-circle',
                        color: '#EF4444',
                        description: 'Процент отмененных записей'
                    },
                    {
                        id: 4,
                        name: 'Удовлетворенность',
                        value: '4.8',
                        change: 0.3,
                        icon: 'star',
                        color: '#F59E0B',
                        description: 'Средняя оценка клиентов'
                    }
                ],

                get filteredMetrics() {
                    if (!this.metricSearch) return this.metrics;
                    const search = this.metricSearch.toLowerCase();
                    return this.metrics.filter(metric => 
                        metric.name.toLowerCase().includes(search) ||
                        metric.description.toLowerCase().includes(search)
                    );
                },

                refreshAIInsights() {
                    // Here would be the actual API call to refresh AI insights
                    this.showToast('ИИ аналитика обновлена', 'success');
                },

                exportMetrics() {
                    // Here would be the actual export logic
                    this.showToast('Метрики экспортированы', 'success');
                },

                initSegmentationChart() {
                    const ctx = document.getElementById('segmentationChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: this.segmentationData[this.segmentationType].labels,
                            datasets: [{
                                data: this.segmentationData[this.segmentationType].data,
                                backgroundColor: ['#3D5AFE', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right'
                                }
                            }
                        }
                    });
                },

                initRevenueAnalysisChart() {
                    const ctx = document.getElementById('revenueAnalysisChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: this.revenueAnalysisData[this.revenueAnalysisType].labels,
                            datasets: [{
                                label: 'Выручка',
                                data: this.revenueAnalysisData[this.revenueAnalysisType].data,
                                backgroundColor: '#3D5AFE'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: value => this.formatCurrency(value)
                                    }
                                }
                            }
                        }
                    });
                },

                init() {
                    this.initCharts();
                    this.initFinancialChart();
                    this.initClientChart();
                    this.initSegmentationChart();
                    this.initRevenueAnalysisChart();
                },

                toast: null,
                reportSearch: '',
                // --- ДОБАВЛЯЮ реактивные watch-эффекты для обновления графиков ---
                period: 'week',
                revenueChartType: 'line',
                servicesChartType: 'pie',
                financialPeriod: 'week',
                clientPeriod: 'week',
                segmentationType: 'age',
                revenueAnalysisType: 'daily',
                $watch: {
                    period() { this.updateCharts(); },
                    revenueChartType() { this.initCharts(); },
                    servicesChartType() { this.initCharts(); },
                    financialPeriod() { this.initFinancialChart(); },
                    clientPeriod() { this.initClientChart(); },
                    segmentationType() { this.initSegmentationChart(); },
                    revenueAnalysisType() { this.initRevenueAnalysisChart(); },
                },
                // --- END ---
                // ... existing methods ...
                showToast(message, type = 'success') {
                    this.toast = { message, type };
                    setTimeout(() => this.toast = null, 3000);
                },
                exportServiceReport() {
                    this.showToast('Отчет по услугам экспортирован', 'success');
                },
                exportMetrics() {
                    this.showToast('Метрики экспортированы', 'success');
                },
                refreshAIInsights() {
                    this.showToast('ИИ аналитика обновлена', 'success');
                },
                // ... existing code ...
            }));
        });

        // Initialize Lucide Icons
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
</body>
</html>
