<!DOCTYPE html>
<html lang="ky" x-data="mobileEmployeeProfile()" x-init="init()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2563eb">
    <title>Zappis — Кызматкердин профили</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        body { background: linear-gradient(135deg, #f3f4f6 0%, #dbeafe 100%); }
        .nav-active { color: #2563eb; }
        .nav-bar { box-shadow: 0 -2px 16px 0 rgba(37,99,235,0.08); }
        .card { box-shadow: 0 2px 12px 0 rgba(0,0,0,0.04); }
        .skeleton { background: linear-gradient(90deg, #e0e7ef 25%, #f3f4f6 50%, #e0e7ef 75%); background-size: 200% 100%; animation: skeleton 1.2s infinite linear; }
        @keyframes skeleton { 0% {background-position: 200% 0;} 100% {background-position: -200% 0;} }
    </style>
</head>
<body class="min-h-screen flex flex-col" style="font-family: system-ui, -apple-system, sans-serif;">
    <!-- AppBar -->
    <header class="fixed top-0 left-0 right-0 z-20 bg-white/90 backdrop-blur border-b border-gray-200 flex items-center justify-between px-4 h-16">
        <button @click="goBack" class="text-gray-600 hover:text-blue-600 flex items-center">
            <i data-lucide="arrow-left" class="w-6 h-6"></i>
        </button>
        <span class="text-lg font-semibold text-gray-900">Профиль</span>
        <button @click="editEmployee()" class="text-gray-600 hover:text-blue-600 flex items-center">
            <i data-lucide="edit" class="w-6 h-6"></i>
        </button>
    </header>
    <!-- Main Content -->
    <main class="flex-1 pt-20 pb-20 px-2 max-w-md mx-auto w-full">
        <template x-if="loading">
            <div class="space-y-4 animate-pulse">
                <div class="h-8 rounded-xl skeleton"></div>
                <div class="h-20 rounded-2xl skeleton"></div>
                <div class="h-20 rounded-2xl skeleton"></div>
            </div>
        </template>
        <template x-if="!loading && employee">
            <div class="space-y-6">
                <!-- Profile Card -->
                <div class="card bg-white rounded-xl p-6 flex flex-col items-center text-center">
                    <div class="w-20 h-20 rounded-full bg-blue-600 flex items-center justify-center text-white text-3xl font-bold mb-2">
                        <span x-text="getInitials(employee.name)"></span>
                    </div>
                    <div class="text-xl font-semibold text-gray-900 mb-1" x-text="employee.name"></div>
                    <div class="text-sm text-gray-500 mb-1" x-text="getPositionName(employee.position)"></div>
                    <span :class="getStatusClass(employee.status)" class="px-3 py-1 text-xs rounded-full mb-2" x-text="getStatusText(employee.status)"></span>
                    <div class="flex justify-center gap-4 mt-2">
                        <div class="text-center">
                            <div class="text-xs text-gray-500">Кардар</div>
                            <div class="text-base font-semibold text-gray-900" x-text="employee.clientsCount ?? '—'"></div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500">Рейтинг</div>
                            <div class="text-base font-semibold text-gray-900" x-text="employee.rating ?? '—'"></div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500">Опыт</div>
                            <div class="text-base font-semibold text-gray-900" x-text="employee.experience ? employee.experience + ' жыл' : '—'"></div>
                        </div>
                    </div>
                </div>
                <!-- Контакты -->
                <div class="card bg-white rounded-xl p-4">
                    <div class="font-semibold text-gray-900 mb-2 flex items-center"><i data-lucide="phone" class="w-4 h-4 mr-2"></i>Байланыштар</div>
                    <div class="space-y-2">
                        <div class="flex items-center text-sm text-gray-700"><i data-lucide="phone" class="w-4 h-4 mr-2"></i><span x-text="employee.phone || '—'"></span></div>
                        <div class="flex items-center text-sm text-gray-700"><i data-lucide="mail" class="w-4 h-4 mr-2"></i><span x-text="employee.email || '—'"></span></div>
                        <div class="flex items-center text-sm text-gray-700"><i data-lucide="map-pin" class="w-4 h-4 mr-2"></i><span x-text="employee.address || '—'"></span></div>
                        <div class="flex items-center text-sm text-gray-700"><i data-lucide="calendar" class="w-4 h-4 mr-2"></i><span x-text="formatDate(employee.birthDate)"></span></div>
                    </div>
                </div>
                <!-- Проф. информация -->
                <div class="card bg-white rounded-xl p-4">
                    <div class="font-semibold text-gray-900 mb-2 flex items-center"><i data-lucide="award" class="w-4 h-4 mr-2"></i>Кесиптик маалымат</div>
                    <div class="mb-2"><span class="font-medium">Билими:</span> <span x-text="employee.education || '—'"></span></div>
                    <div class="mb-2"><span class="font-medium">Көндүмдөрү:</span>
                        <template x-if="employee.skills && employee.skills.trim()">
                            <span>
                                <template x-for="skill in employee.skills.split(',')" :key="skill">
                                    <span class="px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs mr-1" x-text="skill.trim()"></span>
                                </template>
                            </span>
                        </template>
                        <template x-if="!employee.skills || employee.skills.trim() === ''">
                            <span class="text-gray-400">—</span>
                        </template>
                    </div>
                    <div class="mb-2"><span class="font-medium">Сертификаттар:</span>
                        <template x-if="employee.certifications && employee.certifications.trim()">
                            <span>
                                <template x-for="cert in employee.certifications.split(',')" :key="cert">
                                    <span class="px-2 py-0.5 bg-green-100 text-green-800 rounded-full text-xs mr-1" x-text="cert.trim()"></span>
                                </template>
                            </span>
                        </template>
                        <template x-if="!employee.certifications || employee.certifications.trim() === ''">
                            <span class="text-gray-400">—</span>
                        </template>
                    </div>
                    <div class="mb-2"><span class="font-medium">Тилдери:</span>
                        <template x-if="employee.languages && employee.languages.trim()">
                            <span>
                                <template x-for="lang in employee.languages.split(',')" :key="lang">
                                    <span class="px-2 py-0.5 bg-purple-100 text-purple-800 rounded-full text-xs mr-1" x-text="lang.trim()"></span>
                                </template>
                            </span>
                        </template>
                        <template x-if="!employee.languages || employee.languages.trim() === ''">
                            <span class="text-gray-400">—</span>
                        </template>
                    </div>
                    <div class="mb-2"><span class="font-medium">Жетишкендиктер:</span>
                        <template x-if="employee.achievements && employee.achievements.trim()">
                            <span>
                                <template x-for="ach in employee.achievements.split(',')" :key="ach">
                                    <span class="px-2 py-0.5 bg-yellow-100 text-yellow-800 rounded-full text-xs mr-1" x-text="ach.trim()"></span>
                                </template>
                            </span>
                        </template>
                        <template x-if="!employee.achievements || employee.achievements.trim() === ''">
                            <span class="text-gray-400">—</span>
                        </template>
                    </div>
                </div>
                <!-- Документы -->
                <div class="card bg-white rounded-xl p-4">
                    <div class="font-semibold text-gray-900 mb-2 flex items-center"><i data-lucide="file-text" class="w-4 h-4 mr-2"></i>Документтер</div>
                    <div class="mb-2"><span class="font-medium">Паспорт:</span> <span x-text="employee.passportNumber || '—'"></span></div>
                    <div class="mb-2"><span class="font-medium">ИНН:</span> <span x-text="employee.taxId || '—'"></span></div>
                    <div class="mb-2"><span class="font-medium">Сактандыруу:</span> <span x-text="employee.insuranceNumber || '—'"></span></div>
                </div>
                <!-- Банковская информация -->
                <div class="card bg-white rounded-xl p-4">
                    <div class="font-semibold text-gray-900 mb-2 flex items-center"><i data-lucide="credit-card" class="w-4 h-4 mr-2"></i>Банк маалыматы</div>
                    <div class="mb-2"><span class="font-medium">Банк эсеби:</span> <span x-text="employee.bankAccount || '—'"></span></div>
                    <div class="mb-2"><span class="font-medium">Банктын аты:</span> <span x-text="employee.bankName || '—'"></span></div>
                </div>
                <!-- Контакт для экстренной связи -->
                <div class="card bg-white rounded-xl p-4">
                    <div class="font-semibold text-gray-900 mb-2 flex items-center"><i data-lucide="user" class="w-4 h-4 mr-2"></i>Шашылыш байланыш</div>
                    <div class="mb-2"><span class="font-medium">Телефон:</span> <span x-text="employee.emergencyContact || '—'"></span></div>
                    <div class="mb-2"><span class="font-medium">Аты-жөнү:</span> <span x-text="employee.emergencyContactName || '—'"></span></div>
                    <div class="mb-2"><span class="font-medium">Тууганчылыгы:</span> <span x-text="employee.emergencyContactRelation || '—'"></span></div>
                </div>
                <!-- Примечания -->
                <div class="card bg-white rounded-xl p-4">
                    <div class="font-semibold text-gray-900 mb-2 flex items-center"><i data-lucide="info" class="w-4 h-4 mr-2"></i>Эскертүүлөр</div>
                    <div x-text="employee.notes || '—'"></div>
                </div>
            </div>
        </template>
        <template x-if="!loading && !employee">
            <div class="text-center text-gray-400 py-12">Кызматкер жок</div>
        </template>
    </main>
    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 z-30 bg-white nav-bar border-t border-gray-200 flex justify-around items-center h-16 max-w-md mx-auto w-full">
        <a href="/" class="flex flex-col items-center">
            <i data-lucide="home" class="w-6 h-6"></i>
            <span class="text-xs mt-1">Башкы бет</span>
        </a>
        <a href="#" class="flex flex-col items-center">
            <i data-lucide="calendar" class="w-6 h-6"></i>
            <span class="text-xs mt-1">Жазуулар</span>
        </a>
        <a href="employees_mobile.html" class="flex flex-col items-center nav-active">
            <i data-lucide="users" class="w-6 h-6"></i>
            <span class="text-xs mt-1">Кызматкерлер</span>
        </a>
        <a href="#" class="flex flex-col items-center">
            <i data-lucide="user-plus" class="w-6 h-6"></i>
            <span class="text-xs mt-1">Клиенттер</span>
        </a>
        <a href="#" class="flex flex-col items-center">
            <i data-lucide="settings" class="w-6 h-6"></i>
            <span class="text-xs mt-1">Профиль</span>
        </a>
    </nav>
    <template x-if="showEditModal">
        <div class="fixed inset-0 z-50 flex items-end justify-center bg-black bg-opacity-50">
            <div class="bg-white rounded-t-2xl w-full max-w-md flex flex-col shadow-2xl" style="max-height: 95vh;" x-effect="lucide.createIcons()">
                <!-- Градиентная шапка -->
                <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-4 flex items-center justify-between rounded-t-2xl">
                    <div class="flex items-center space-x-3">
                        <div class="w-9 h-9 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <i data-lucide="user-plus" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold" x-text="editForm.id ? 'Кызматкерди түзөтүү' : 'Жаңы кызматкер'"></h2>
                            <p class="text-blue-100 text-xs">Кызматкердин маалыматын толтуруңуз</p>
                        </div>
                    </div>
                    <button @click="showEditModal = false" class="text-white hover:bg-white hover:bg-opacity-20 p-2 rounded-full transition-all">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <!-- Табы -->
                <div class="border-b border-gray-200 bg-gray-50 flex-shrink-0">
                    <div class="flex">
                        <template x-for="tab in editTabs" :key="tab.key">
                            <button type="button" @click="activeEditTab = tab.key; $nextTick(() => lucide.createIcons())" :class="activeEditTab === tab.key ? 'bg-white text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-900'" class="flex-1 px-4 py-3 text-sm font-medium transition-all flex flex-col items-center">
                                <i :data-lucide="tab.icon" class="w-5 h-5 mb-1"></i>
                                <span x-text="tab.label"></span>
                            </button>
                        </template>
                    </div>
                </div>
                <!-- Содержимое -->
                <div class="flex-1 overflow-y-auto px-4 py-2 space-y-6" style="min-height:0;">
                    <form @submit.prevent="submitEditEmployee" class="space-y-6">
                        <!-- Основное -->
                        <div x-show="activeEditTab === 'main'" class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                                    <i data-lucide="user" class="w-4 h-4 text-white"></i>
                                </div>
                                <h4 class="text-base font-semibold text-gray-900">Жеке маалымат</h4>
                            </div>
                            <div class="space-y-3">
                                <div class="relative">
                                    <i data-lucide="user" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.name" placeholder="Аты-жөнү" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.name ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.name" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.name"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="briefcase" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.position" placeholder="Кызматы" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.position ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.position" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.position"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="clock" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="number" x-model="editForm.experience" placeholder="Опыт (жыл)" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.experience ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.experience" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.experience"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="credit-card" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="number" x-model="editForm.salary" placeholder="Айлык акы" class="w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.salary ? 'border-red-500 ring-red-200' : ''">
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm">сом</span>
                                    <div x-show="editErrors.salary" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.salary"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Контакты -->
                        <div x-show="activeEditTab === 'contacts'" class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center">
                                    <i data-lucide="phone" class="w-4 h-4 text-white"></i>
                                </div>
                                <h4 class="text-base font-semibold text-gray-900">Байланыш маалыматы</h4>
                            </div>
                            <div class="space-y-3">
                                <div class="relative">
                                    <i data-lucide="phone" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.phone" placeholder="Телефон" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.phone ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.phone" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.phone"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="mail" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="email" x-model="editForm.email" placeholder="Email" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.email ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.email" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.email"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="map-pin" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.address" placeholder="Адрес" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.address ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.address" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.address"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Проф. информация -->
                        <div x-show="activeEditTab === 'prof'" class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 border border-purple-100">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center">
                                    <i data-lucide="calendar" class="w-4 h-4 text-white"></i>
                                </div>
                                <h4 class="text-base font-semibold text-gray-900">Кесиптик маалымат</h4>
                            </div>
                            <div class="space-y-3">
                                <div class="relative">
                                    <i data-lucide="calendar" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="date" x-model="editForm.birthDate" placeholder="Дата рождения" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.birthDate ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.birthDate" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.birthDate"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="graduation-cap" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.education" placeholder="Билими" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.education ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.education" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.education"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="award" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.skills" placeholder="Көндүмдөрү (через запятую)" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.skills ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.skills" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.skills"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="globe" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.languages" placeholder="Тилдери (через запятую)" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.languages ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.languages" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.languages"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="certificate" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.certifications" placeholder="Сертификаттар" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.certifications ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.certifications" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.certifications"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="star" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.achievements" placeholder="Жетишкендиктер" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.achievements ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.achievements" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.achievements"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="tool" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.equipment" placeholder="Оборудование" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.equipment ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.equipment" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.equipment"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Документы -->
                        <div x-show="activeEditTab === 'docs'" class="bg-gradient-to-r from-pink-50 to-red-50 rounded-xl p-4 border border-pink-100">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-pink-600 rounded-lg flex items-center justify-center">
                                    <i data-lucide="file-text" class="w-4 h-4 text-white"></i>
                                </div>
                                <h4 class="text-base font-semibold text-gray-900">Документтер</h4>
                            </div>
                            <div class="space-y-3">
                                <div class="relative">
                                    <i data-lucide="file-text" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.passportNumber" placeholder="Паспорт" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.passportNumber ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.passportNumber" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.passportNumber"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="calendar" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="date" x-model="editForm.passportIssued" placeholder="Дата выдачи паспорта" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.passportIssued ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.passportIssued" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.passportIssued"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="calendar" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="date" x-model="editForm.passportExpiry" placeholder="Срок действия паспорта" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.passportExpiry ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.passportExpiry" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.passportExpiry"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="file-text" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.taxId" placeholder="ИНН" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.taxId ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.taxId" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.taxId"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Банк -->
                        <div x-show="activeEditTab === 'bank'" class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                                    <i data-lucide="credit-card" class="w-4 h-4 text-white"></i>
                                </div>
                                <h4 class="text-base font-semibold text-gray-900">Банк маалыматы</h4>
                            </div>
                            <div class="space-y-3">
                                <div class="relative">
                                    <i data-lucide="file-text" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.bankAccount" placeholder="Банковский счет" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.bankAccount ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.bankAccount" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.bankAccount"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="file-text" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.bankName" placeholder="Название банка" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.bankName ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.bankName" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.bankName"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Страховка/контракт -->
                        <div x-show="activeEditTab === 'insurance'" class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-4 border border-orange-100">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-orange-600 rounded-lg flex items-center justify-center">
                                    <i data-lucide="shield" class="w-4 h-4 text-white"></i>
                                </div>
                                <h4 class="text-base font-semibold text-gray-900">Страховка и контракт</h4>
                            </div>
                            <div class="space-y-3">
                                <div class="relative">
                                    <i data-lucide="shield" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.insuranceNumber" placeholder="Номер страховки" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.insuranceNumber ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.insuranceNumber" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.insuranceNumber"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="calendar" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="date" x-model="editForm.insuranceExpiry" placeholder="Срок действия страховки" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.insuranceExpiry ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.insuranceExpiry" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.insuranceExpiry"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="file-text" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.contractNumber" placeholder="Номер контракта" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.contractNumber ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.contractNumber" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.contractNumber"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="calendar" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="date" x-model="editForm.contractExpiry" placeholder="Срок действия контракта" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.contractExpiry ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.contractExpiry" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.contractExpiry"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Отпуск/больничные -->
                        <div x-show="activeEditTab === 'vacation'" class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                                    <i data-lucide="calendar" class="w-4 h-4 text-white"></i>
                                </div>
                                <h4 class="text-base font-semibold text-gray-900">Отпуск жана больничные</h4>
                            </div>
                            <div class="space-y-3">
                                <div class="relative">
                                    <i data-lucide="calendar" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="number" x-model="editForm.vacationDaysTotal" placeholder="Бардык отпуску күндөрү" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.vacationDaysTotal ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.vacationDaysTotal" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.vacationDaysTotal"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="calendar" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="number" x-model="editForm.vacationDaysUsed" placeholder="Пайдаланган отпуску күндөрү" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.vacationDaysUsed ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.vacationDaysUsed" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.vacationDaysUsed"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="calendar" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="number" x-model="editForm.sickDaysTotal" placeholder="Бардык больничный күндөрү" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.sickDaysTotal ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.sickDaysTotal" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.sickDaysTotal"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="calendar" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="number" x-model="editForm.sickDaysUsed" placeholder="Пайдаланган больничный күндөрү" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.sickDaysUsed ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.sickDaysUsed" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.sickDaysUsed"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Экстренный контакт -->
                        <div x-show="activeEditTab === 'emergency'" class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center">
                                    <i data-lucide="user" class="w-4 h-4 text-white"></i>
                                </div>
                                <h4 class="text-base font-semibold text-gray-900">Экстренный контакт</h4>
                            </div>
                            <div class="space-y-3">
                                <div class="relative">
                                    <i data-lucide="phone" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.emergencyContact" placeholder="Телефон экстренного контакта" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.emergencyContact ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.emergencyContact" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.emergencyContact"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="user" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.emergencyContactName" placeholder="Имя экстренного контакта" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.emergencyContactName ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.emergencyContactName" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.emergencyContactName"></span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <i data-lucide="users" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                    <input type="text" x-model="editForm.emergencyContactRelation" placeholder="Отношение" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.emergencyContactRelation ? 'border-red-500 ring-red-200' : ''">
                                    <div x-show="editErrors.emergencyContactRelation" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        <span x-text="editErrors.emergencyContactRelation"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Примечания -->
                        <div x-show="activeEditTab === 'notes'" class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                                    <i data-lucide="info" class="w-4 h-4 text-white"></i>
                                </div>
                                <h4 class="text-base font-semibold text-gray-900">Примечания</h4>
                            </div>
                            <div class="relative">
                                <i data-lucide="file-text" class="absolute left-3 top-3 w-4 h-4 text-gray-400"></i>
                                <textarea x-model="editForm.notes" placeholder="Примечания" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all mb-2" :class="editErrors.notes ? 'border-red-500 ring-red-200' : ''"></textarea>
                                <div x-show="editErrors.notes" class="text-xs text-red-600 mt-1 flex items-center space-x-1">
                                    <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                    <span x-text="editErrors.notes"></span>
                                </div>
                            </div>
                        </div>
                        <div class="h-4"></div>
                    </form>
                </div>
                <!-- Кнопки -->
                <div class="bg-gray-50 px-4 py-3 border-t border-gray-200 flex-shrink-0 flex space-x-3 sticky bottom-0 z-10">
                    <button @click="showEditModal = false" class="flex-1 px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 transition-all flex items-center justify-center space-x-2">
                        <i data-lucide="x" class="w-5 h-5"></i>
                        <span>Отмена</span>
                    </button>
                    <button @click="submitEditEmployee" :disabled="editLoading" :class="editLoading ? 'opacity-60 pointer-events-none' : ''" class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all flex items-center justify-center space-x-2 shadow-lg">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        <span>Сактоо</span>
                    </button>
                </div>
            </div>
        </div>
    </template>
    <!-- Toast -->
    <template x-if="toast">
        <div :class="toast.type === 'success' ? 'bg-green-500' : 'bg-red-500'" class="fixed top-6 right-6 z-50 px-6 py-4 rounded-xl shadow-2xl text-white text-base font-medium flex items-center space-x-3" style="min-width: 220px; max-width: 350px;">
            <i :data-lucide="toast.type === 'success' ? 'check-circle' : 'alert-circle'" class="w-5 h-5 text-white"></i>
            <span x-text="toast.message"></span>
            <button @click="toast = null" class="ml-2 p-1 rounded-full hover:bg-white hover:bg-opacity-20 transition-all">
                <i data-lucide="x" class="w-5 h-5 text-white"></i>
            </button>
        </div>
    </template>
    <script>
    function mobileEmployeeProfile() {
        function getDefaultEmployeeForm() {
            return {
                name: '', position: '', phone: '', email: '', status: 'active', experience: 0, birthDate: '', education: '', skills: '', address: '', salary: 0, schedule: 'full', clientsCount: 0, rating: 0, passportNumber: '', passportIssued: '', passportExpiry: '', taxId: '', bankAccount: '', bankName: '', emergencyContact: '', emergencyContactName: '', emergencyContactRelation: '', startDate: '', contractNumber: '', contractExpiry: '', vacationDaysTotal: 28, vacationDaysUsed: 0, sickDaysTotal: 30, sickDaysUsed: 0, certifications: '', languages: '', achievements: '', notes: '', equipment: '', insuranceNumber: '', insuranceExpiry: '', performanceReviews: [], trainingHistory: [], workSchedule: {monday:'',tuesday:'',wednesday:'',thursday:'',friday:'',saturday:'',sunday:''}, salaryHistory: [], documents: []
            };
        }
        return {
            loading: true,
            employee: null,
            showEditModal: false,
            editForm: {},
            editErrors: {},
            editLoading: false,
            toast: null,
            activeEditTab: 'main',
            editTabs: [
                { key: 'main', label: 'Основное', icon: 'user' },
                { key: 'contacts', label: 'Контакттар', icon: 'phone' },
                { key: 'prof', label: 'Проф.', icon: 'award' },
                { key: 'docs', label: 'Документтер', icon: 'file-text' },
                { key: 'bank', label: 'Банк', icon: 'credit-card' },
                { key: 'insurance', label: 'Страховка', icon: 'shield' },
                { key: 'vacation', label: 'Отпуск', icon: 'calendar' },
                { key: 'emergency', label: 'Экстр.', icon: 'user' },
                { key: 'notes', label: 'Примечания', icon: 'info' }
            ],
            async init() {
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('id');
                if (id) {
                    try {
                        const response = await fetch(`/employees/api/employees/${id}/`);
                        if (!response.ok) throw new Error('Not found');
                        this.employee = await response.json();
                    } catch (e) {
                        this.employee = null;
                    }
                }
                this.loading = false;
                lucide.createIcons();
            },
            goBack() {
                window.history.length > 1 ? window.history.back() : window.location.href = 'employees_mobile.html';
            },
            async editEmployee() {
                if (!this.employee) return;
                this.editForm = { ...getDefaultEmployeeForm(), ...this.employee };
                this.activeEditTab = 'main';
                this.editErrors = {};
                this.showEditModal = true;
                this.$nextTick(() => lucide.createIcons());
            },
            async submitEditEmployee() {
                this.editErrors = {};
                if (!this.validateEditForm()) return;
                this.editLoading = true;
                try {
                    const payload = { ...this.editForm };
                    [
                        'birthDate','passportIssued','passportExpiry','contractExpiry','insuranceExpiry'
                    ].forEach(f => { if (payload[f] === '') payload[f] = null; });
                    const response = await fetch(`/employees/api/employees/${this.employee.id}/`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': this.getCsrfToken ? this.getCsrfToken() : ''
                        },
                        body: JSON.stringify(payload)
                    });
                    const data = await response.json();
                    if (response.ok) {
                        this.employee = data;
                        this.showEditModal = false;
                        this.showToast('Өзгөртүү сакталды', 'success');
                    } else if (response.status === 400 && data) {
                        this.editErrors = data;
                        const firstErrorKey = Object.keys(data)[0];
                        const firstError = data[firstErrorKey];
                        let errorText = Array.isArray(firstError) ? firstError[0] : firstError;
                        this.showToast('Алдаа: ' + errorText, 'error');
                        this.$nextTick(() => {
                            const errorField = document.querySelector('[x-model="editForm.' + firstErrorKey + '"]');
                            if (errorField) {
                                errorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                errorField.focus();
                                errorField.classList.add('error-highlight');
                                setTimeout(() => errorField.classList.remove('error-highlight'), 2000);
                            }
                        });
                    } else {
                        this.showToast(data.message ? 'Алдаа: ' + data.message : 'Сактоо алдаа', 'error');
                    }
                } catch (e) {
                    this.showToast('Сактоо алдаа: ' + e.message, 'error');
                } finally {
                    this.editLoading = false;
                }
            },
            validateEditForm() {
                let valid = true;
                if (!this.editForm.name || this.editForm.name.trim().length < 2) {
                    this.editErrors.name = 'Корректкө имени жана фамилия (минимум 2 символу)';
                    valid = false;
                }
                if (!this.editForm.position) {
                    this.editErrors.position = 'Должностуну тандаңыз';
                    valid = false;
                }
                if (!this.editForm.phone) {
                    this.editErrors.phone = 'Телефонду тандаңыз';
                    valid = false;
                }
                if (this.editForm.email && !/^.+@.+\..+$/.test(this.editForm.email)) {
                    this.editErrors.email = 'Корректкө электрондук почта';
                    valid = false;
                }
                return valid;
            },
            showToast(message, type) {
                this.toast = { message, type };
                setTimeout(() => this.toast = null, 3000);
            },
            getCsrfToken() {
                const name = 'csrftoken';
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    cookie = cookie.trim();
                    if (cookie.startsWith(name + '=')) {
                        return decodeURIComponent(cookie.substring(name.length + 1));
                    }
                }
                return '';
            },
            getInitials(name) {
                if (!name) return '';
                return name.split(' ').map(w => w[0]).join('').toUpperCase();
            },
            getPositionName(position) {
                const positions = {
                    'master': 'Мастер',
                    'administrator': 'Администратор',
                    'manager': 'Менеджер',
                    'stylist': 'Стилист',
                    'cosmetologist': 'Косметолог'
                };
                return positions[position] || position || '—';
            },
            getStatusText(status) {
                const map = { active: 'Активдүү', inactive: 'Иштен чыккан', vacation: 'Эс алууда', sick: 'Ооруган' };
                return map[status] || status;
            },
            getStatusClass(status) {
                const map = {
                    active: 'bg-green-100 text-green-800',
                    inactive: 'bg-red-100 text-red-800',
                    vacation: 'bg-yellow-100 text-yellow-800',
                    sick: 'bg-orange-100 text-orange-800'
                };
                return map[status] || 'bg-gray-100 text-gray-800';
            },
            formatDate(date) {
                if (!date) return '—';
                try {
                    return new Date(date).toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' });
                } catch { return '—'; }
            }
        }
    }
    document.addEventListener('DOMContentLoaded', function() { lucide.createIcons(); });
    </script>
</body>
</html> 